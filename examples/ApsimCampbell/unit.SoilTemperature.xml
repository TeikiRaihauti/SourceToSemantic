<?xml version="1.0" ?>
<ModelUnit modelid=".SoilTemperature" name="SoilTemperature" timestep="1" version="-">
	<Description>
		<Title>SoilTemperature</Title>
		<Authors>-</Authors>
		<Institution>-</Institution>
		<URI>Models.Soils.SoilTemp.SoilTemperature</URI>
		<Reference>-</Reference>
		<ExtendedDescription>The soil temperature model simulates heat flux and temperatures over the soil profile, including the soil surface. Processes are largely based on Campbell (1985). The soil is represented by temperature nodes, including an atmospheric node and a surface node, and nodes at the centre of each soil layer plus phantom nodes below the profile for boundary conditions.</ExtendedDescription>
		<ShortDescription>Daily soil temperature and heat flux simulation over a layered soil profile.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="InitialValues" description="Initial values for the temperature in each soil layer (oC)" inputtype="parameter" parametercategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="DepthToConstantTemperature" description="Depth down to the constant temperature zone" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="10000.0" unit="mm" uri=""/>
		<Input name="pom" description="Particle density of organic matter" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="1.3" unit="Mg/m3" uri=""/>
		<Input name="ps" description="Particle density of soil fines (minerals)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="2.63" unit="Mg/m3" uri=""/>
		<Input name="timestep" description="Internal time-step length" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="86400.0" unit="s" uri=""/>
		<Input name="latentHeatOfVapourisation" description="Latent heat of vaporisation for water" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="2465000.0" unit="J/kg" uri=""/>
		<Input name="stefanBoltzmannConstant" description="Stefan-Boltzmann constant" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="5.67E-8" unit="W/m2/K4" uri=""/>
		<Input name="airNode" description="Index of the atmosphere node" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="0" unit="-" uri=""/>
		<Input name="surfaceNode" description="Index of the soil surface node" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="1" unit="-" uri=""/>
		<Input name="topsoilNode" description="Index of the first node within soil (top layer)" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="2" unit="-" uri=""/>
		<Input name="numPhantomNodes" description="Number of phantom nodes below the soil profile" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="5" unit="-" uri=""/>
		<Input name="constantBoundaryLayerConductance" description="Boundary layer conductance when using constant option" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="20" unit="W/K" uri=""/>
		<Input name="numIterationsForBoundaryLayerConductance" description="Number of iterations for boundary layer conductance calculation" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="1" unit="-" uri=""/>
		<Input name="defaultTimeOfMaximumTemperature" description="Time of maximum air temperature (hour of day)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="14.0" unit="h" uri=""/>
		<Input name="defaultInstrumentHeight" description="Default instrument (wind/temperature) height above ground" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="1.2" unit="m" uri=""/>
		<Input name="bareSoilRoughness" description="Roughness element height of bare soil" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="57" unit="mm" uri=""/>
		<Input name="nu" description="Forward/backward differencing coefficient for numerical scheme" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="1" min="0" default="0.6" unit="-" uri=""/>
		<Input name="boundarLayerConductanceSource" description="Source for boundary layer conductance: 'calc' or 'constant'" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="" min="" default="calc" unit="-" uri=""/>
		<Input name="netRadiationSource" description="Source for net radiation at surface: 'calc' or 'eos'" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="" min="" default="calc" unit="-" uri=""/>
		<Input name="weather_MeanT" description="Daily mean air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="oC" uri=""/>
		<Input name="weather_MaxT" description="Daily maximum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="oC" uri=""/>
		<Input name="weather_MinT" description="Daily minimum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="oC" uri=""/>
		<Input name="weather_Tav" description="Annual average air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="oC" uri=""/>
		<Input name="weather_Amp" description="Annual amplitude of air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="oC" uri=""/>
		<Input name="weather_Radn" description="Daily incoming shortwave radiation" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="MJ/m2/day" uri=""/>
		<Input name="weather_Latitude" description="Site latitude" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="90" min="-90" default="" unit="deg" uri=""/>
		<Input name="weather_AirPressure" description="Air pressure" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="hPa" uri=""/>
		<Input name="weather_Wind" description="Wind speed at instrument height" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="m/s" uri=""/>
		<Input name="clock_TodayDayOfYear" description="Day of year for current simulation date" inputtype="variable" variablecategory="exogenous" datatype="INT" max="366" min="1" default="" unit="-" uri=""/>
		<Input name="microClimate_CanopyHeight" description="Height of canopy above ground" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="0" default="" unit="m" uri=""/>
		<Input name="physical_Thickness" description="Soil layer thickness" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="mm" uri=""/>
		<Input name="physical_BD" description="Soil bulk density" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="g/cm3" uri=""/>
		<Input name="physical_Rocks" description="Volumetric fraction of rocks" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="physical_ParticleSizeSand" description="Particle size fraction sand" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="physical_ParticleSizeSilt" description="Particle size fraction silt" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="physical_ParticleSizeClay" description="Particle size fraction clay" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="organic_Carbon" description="Soil organic carbon" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="%" uri=""/>
		<Input name="waterBalance_SW" description="Layer volumetric soil water content" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="1" min="0" default="" unit="mm3/mm3" uri=""/>
		<Input name="waterBalance_Eos" description="Soil evaporation (potential) used for net radiation/cover effects" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="0" default="" unit="mm/day" uri=""/>
		<Input name="waterBalance_Eo" description="Reference evaporation (EO) used for cover scaling" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="0" default="" unit="mm/day" uri=""/>
		<Input name="waterBalance_Es" description="Soil evaporation (actual) used for latent heat flux" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="0" default="" unit="mm/day" uri=""/>
		<Input name="waterBalance_Salb" description="Soil albedo used for shortwave net radiation and initial surface T" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="1" min="0" default="" unit="-" uri=""/>
		<Input name="instrumHeight" description="Optional instrument height override" inputtype="parameter" parametercategory="auxiliary" datatype="DOUBLE" max="" min="0" default="" unit="m" uri=""/>
		<Input name="instrumentHeight" description="Instrument height used in boundary layer conductance (derived/defaulted)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="0" default="1.2" unit="m" uri=""/>
		<Input name="soilRoughnessHeight" description="Soil surface roughness height" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="0" default="57" unit="mm" uri=""/>
		<Input name="numLayers" description="Number of soil layers" inputtype="variable" variablecategory="state" datatype="INT" max="" min="0" default="" unit="-" uri=""/>
		<Input name="numNodes" description="Number of temperature nodes (layers + phantom)" inputtype="variable" variablecategory="state" datatype="INT" max="" min="0" default="" unit="-" uri=""/>
		<Input name="thickness" description="Thickness of each soil layer including phantom layers" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="mm" uri=""/>
		<Input name="nodeDepth" description="Depth of nodes from surface" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="m" uri=""/>
		<Input name="bulkDensity" description="Soil bulk density per layer including phantom layers" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="g/cm3" uri=""/>
		<Input name="rocks" description="Volumetric fraction of rocks per layer (%)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="carbon" description="Volumetric fraction of carbon per layer (%)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="sand" description="Volumetric fraction of sand per layer (%)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="silt" description="Volumetric fraction of silt per layer (%)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="clay" description="Volumetric fraction of clay per layer (%)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="100" min="0" default="" unit="%" uri=""/>
		<Input name="soilWater" description="Volumetric water content per layer including phantom layers" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="1" min="0" default="" unit="mm3/mm3" uri=""/>
		<Input name="soilTemp" description="Soil temperature profile (air node, surface, layers, phantom nodes)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="morningSoilTemp" description="Soil temperature profile captured in the morning" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="newTemperature" description="Provisional new temperature profile computed each sub-daily step" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="minSoilTemp" description="Minimum soil temperature over the day (per node)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="maxSoilTemp" description="Maximum soil temperature over the day (per node)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="aveSoilTemp" description="Average soil temperature over the day (per node)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
		<Input name="boundaryLayerConductance" description="Average daily atmospheric boundary layer conductance" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="0" default="0" unit="W/K" uri=""/>
		<Input name="volSpecHeatSoil" description="Volumetric heat capacity per node (layer-to-node mapped)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="J/K/m3" uri=""/>
		<Input name="thermalConductivity" description="Thermal conductivity per node (layer-to-node mapped)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="W.m/K" uri=""/>
		<Input name="thermalConductance" description="Thermal conductance between nodes (index same as upper node)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="W/K" uri=""/>
		<Input name="heatStorage" description="Heat storage term at nodes for the time step" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" default="" unit="W/K" uri=""/>
		<Input name="internalTimeStep" description="Computed sub-daily internal timestep for the day" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="" min="0" default="" unit="s" uri=""/>
		<Input name="timeOfDaySecs" description="Time of day from midnight for sub-daily integration" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="86400" min="0" default="" unit="s" uri=""/>
		<Input name="airTemperature" description="Interpolated sub-daily air temperature" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="" min="" default="" unit="oC" uri=""/>
		<Input name="minTempYesterday" description="Yesterday's minimum air temperature used in diurnal interpolation" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="" min="" default="0" unit="oC" uri=""/>
		<Input name="maxTempYesterday" description="Yesterday's maximum air temperature used in diurnal interpolation" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="" min="" default="0" unit="oC" uri=""/>
		<Input name="netRadiation" description="Net radiation per internal time-step (shortwave + longwave)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="" min="" default="0" unit="MJ per step" uri=""/>
		<Input name="canopyHeight" description="Canopy/roughness height used in boundary layer calculations" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="" min="0" default="" unit="m" uri=""/>
		<Input name="pInitialValues" description="Internal storage of initial layer temperatures (if provided)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="oC" uri=""/>
	</Inputs>
	<Outputs>
		<Output name="FinalSoilTemperature" description="Temperatures over the soil profile at end of day (midnight)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="oC" uri=""/>
		<Output name="FinalSoilSurfaceTemperature" description="Soil surface temperature at end of day (midnight)" variablecategory="state" datatype="DOUBLE" max="" min="" unit="oC" uri=""/>
		<Output name="Value" description="ISoilTemperature.Value (alias of AverageSoilTemperature)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="oC" uri=""/>
		<Output name="AverageSoilTemperature" description="Temperatures over soil profile averaged over a day" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="oC" uri=""/>
		<Output name="AverageSoilSurfaceTemperature" description="Soil surface temperature averaged over a day" variablecategory="state" datatype="DOUBLE" max="" min="" unit="oC" uri=""/>
		<Output name="MinimumSoilTemperature" description="Minimum temperatures over the soil profile within a day" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="oC" uri=""/>
		<Output name="MinimumSoilSurfaceTemperature" description="Minimum soil surface temperature within a day" variablecategory="state" datatype="DOUBLE" max="" min="" unit="oC" uri=""/>
		<Output name="MaximumSoilTemperature" description="Maximum temperatures over the soil profile within a day" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="oC" uri=""/>
		<Output name="MaximumSoilSurfaceTemperature" description="Maximum soil surface temperature within a day" variablecategory="state" datatype="DOUBLE" max="" min="" unit="oC" uri=""/>
		<Output name="BoundaryLayerConductance" description="Atmospheric boundary layer conductance averaged over a day" variablecategory="state" datatype="DOUBLE" max="" min="0" unit="W/K" uri=""/>
		<Output name="ThermalConductivity" description="Thermal conductivity over the soil profile (node-based)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" unit="W.m/K" uri=""/>
		<Output name="HeatCapacity" description="Volumetric heat capacity over the soil profile (node-based)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" unit="J/K/m3" uri=""/>
		<Output name="HeatStore" description="Heat storage over the soil profile (node-based)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="0" unit="J/K" uri=""/>
		<Output name="Thr_profile" description="Snapshot of morning soil temperature profile (debug/diagnostic)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="oC" uri=""/>
	</Outputs>
	<Initialization name="OnStartOfSimulation" language="cyml" filename="algo/pyx/OnStartOfSimulation.pyx"/>
	<Function name="doNetRadiation" description="Pre-computes per-timestep solar radiation partitioning and atmospheric variables (cloud fraction, vapour concentration) for the day." language="cyml" type="external" filename="algo/pyx/doNetRadiation.pyx"/>
	<Function name="Zero" description="Utility to zero all elements of an array." language="cyml" type="external" filename="algo/pyx/Zero.pyx"/>
	<Function name="doVolumetricSpecificHeat" description="Computes volumetric heat capacity per node from soil constituents and water, then maps layer to node." language="cyml" type="external" filename="algo/pyx/doVolumetricSpecificHeat.pyx"/>
	<Function name="doThermalConductivity" description="Computes thermal conductivity per layer from soil constituents and water and maps to nodes." language="cyml" type="external" filename="algo/pyx/doThermalConductivity.pyx"/>
	<Function name="interpolateTemperature" description="Interpolates sub-daily air temperature from daily min/max using sinusoidal/linear scheme." language="cyml" type="external" filename="algo/pyx/interpolateTemperature.pyx"/>
	<Function name="interpolateNetRadiation" description="Computes timestep net radiation at soil surface from solar radiation, cloud, vapour and cover." language="cyml" type="external" filename="algo/pyx/interpolateNetRadiation.pyx"/>
	<Function name="getBoundaryLayerConductance" description="Calculates atmospheric boundary layer conductance including stability and radiative terms." language="cyml" type="external" filename="algo/pyx/getBoundaryLayerConductance.pyx"/>
	<Function name="doThomas" description="Solves the tridiagonal system for heat diffusion using the Thomas algorithm with surface and bottom boundary conditions." language="cyml" type="external" filename="algo/pyx/doThomas.pyx"/>
	<Function name="doUpdate" description="Updates state arrays (soil temperatures), and aggregates min, max, average temperatures and daily boundary conductance." language="cyml" type="external" filename="algo/pyx/doUpdate.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/doProcess.pyx"/>
	<Parametersets/>
	<Testsets>
		<Testset name="t_-" description="-">
			<Test name="t_-">
				<OutputValue name="-">-</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
