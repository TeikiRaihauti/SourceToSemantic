<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP - Soil temperature by layer" name="STEMP - Soil temperature by layer" timestep="1" version="1.0">
	<Description>
		<Title>STEMP - Soil temperature by layer</Title>
		<Authors>DSSAT (DSSAT Florida)</Authors>
		<Institution>University of Georgia; University of Florida; Iowa State University; International Center for Soil Fertility and Agricultural Development (IFDC); University of Guelph</Institution>
		<URI>-</URI>
		<Reference>https://doi.org/10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Calculates daily soil temperature profile by layer using the EPIC/Parton-Logan approach driven by annual mean temperature (TAV), amplitude (TAMP), daily weather (TAVG/TMAX, SRAD), soil albedo, bulk density, and water content. Produces layer temperatures and a soil surface temperature while maintaining a 5-day moving average.</ExtendedDescription>
		<ShortDescription>Determines soil temperature by layer.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="CONTROL_YRDOY" description="Simulation date in YYYYDDD format" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="ISWITCH_ISWWAT" description="Water simulation switch ('Y' or 'N')" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_BD" description="Bulk density per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="SOILPROP_DLAYR" description="Layer thickness per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DS" description="Cumulative depth per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DUL" description="Drained upper limit per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_LL" description="Lower limit per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_MSALB" description="Mulch/soil albedo" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SRAD" description="Daily solar radiation" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="MJ/m2-d" uri="-"/>
		<Input name="SW" description="Volumetric soil water per layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="TAVG" description="Average daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TMAX" description="Maximum daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="XLAT" description="Latitude (sign determines hemisphere)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="deg" uri="-"/>
		<Input name="TAV" description="Average annual soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TAMP" description="Amplitude of annual soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="CUMDPT" description="Cumulative depth of soil profile" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to midpoint of each soil layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Total water content at DUL (cumulative as in original)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="Last 5 days average soil temperatures (moving window)" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="ATOT" description="Sum of TMA array" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="SRFTEMP" description="Surface soil temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="HDAY" description="Day-of-year of climatological hottest day" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="doy" uri="-"/>
		<Input name="ALBEDO" description="Albedo passed to SOILT (from MSALB)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="B" description="Empirical coefficient for damping function" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DOY" description="Day-of-year derived from date" inputtype="variable" variablecategory="auxiliary" datatype="INT" max="366" min="1" default="-" unit="doy" uri="-"/>
		<Input name="DP" description="Damping depth" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="PESW" description="Plant-extractable soil water (profile total)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="WW" description="Fraction of water content at saturation (empirical)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="YRDOY" description="Date in YYYYDDD used by YR_DOY helper" inputtype="variable" variablecategory="auxiliary" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="x" description="Value rounded by _nint (nearest integer, halves away from zero)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="CUMDPT" description="Cumulative depth of soil profile" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="mm" uri="-"/>
		<Output name="DSMID" description="Depth to midpoint of each soil layer" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" unit="mm" uri="-"/>
		<Output name="TDL" description="Total water content at DUL (cumulative as in original)" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="cm" uri="-"/>
		<Output name="TMA" description="Last 5 days average soil temperatures (moving window)" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" unit="C" uri="-"/>
		<Output name="ATOT" description="Sum of TMA array" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="C" uri="-"/>
		<Output name="SRFTEMP" description="Surface soil temperature" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="C" uri="-"/>
		<Output name="ST" description="Soil temperature by layer" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" unit="C" uri="-"/>
		<Output name="HDAY" description="Day-of-year of climatological hottest day" variablecategory="state" datatype="DOUBLE" max="366" min="1" unit="doy" uri="-"/>
	</Outputs>
	<Initialization name="STEMP_Initialize" language="cyml" filename="algo/pyx/STEMP_Initialize.pyx"/>
	<Function name="YR_DOY" description="Converts YRDOY (YYYYDDD) to (YEAR, DOY)." language="cyml" type="external" filename="algo/pyx/YR_DOY.pyx"/>
	<Function name="_nint" description="Fortran NINT: nearest integer, halves away from zero." language="cyml" type="external" filename="algo/pyx/_nint.pyx"/>
	<Function name="SOILT" description="Soil temperature by layer. Supports STEMP." language="cyml" type="external" filename="algo/pyx/SOILT.pyx"/>
	<Function name="STEMP_Initialize" description="Seasonal initialization for STEMP component." language="cyml" type="external" filename="algo/pyx/STEMP_Initialize.pyx"/>
	<Function name="STEMP" description="Main daily soil temperature process (RATE step)." language="cyml" type="external" filename="algo/pyx/STEMP.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP.pyx"/>
	<Parametersets/>
	<Testsets/>
</ModelUnit>
