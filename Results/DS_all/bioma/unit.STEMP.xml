<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP (Soil Temperature Module, DSSAT/EPIC-based)" name="STEMP (Soil Temperature Module, DSSAT/EPIC-based)" timestep="1" version="-">
	<Description>
		<Title>STEMP (Soil Temperature Module, DSSAT/EPIC-based)</Title>
		<Authors>DSSAT Development Team</Authors>
		<Institution>DSSAT Foundation; University of Florida, IFAS</Institution>
		<URI>https://github.com/DSSAT/dssat-csm</URI>
		<Reference>10.1016/S1161-0301(02)00107-7</Reference>
		<ExtendedDescription>STEMP computes daily soil temperature at the surface and by layer using a damped sinusoidal formulation driven by mean annual temperature (TAV), annual amplitude (TAMP), day of year and hemispheric phase (HDAY). Damping depth (DP) is derived from bulk density and soil water effects (FX, WW), with instantaneous water supply (PESW) controlled by ISWWAT. The model updates a 5-day moving average of surface temperature (TMA) to derive a temperature offset (DT), then calculates layer temperatures (ST) as a depth-attenuated cosine wave (exp(ZD)) and returns surface temperature (SRFTEMP), cumulative depth and mid-layer depths (CUMDPT, DSMID), and totals at drained upper limit (TDL). This C# implementation is a port of the EPIC/DSSAT soil temperature routine.</ExtendedDescription>
		<ShortDescription>Daily soil temperature profile module (EPIC/DSSAT) using a depth-damped sinusoid adjusted by bulk density and soil water.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="NL" description="Number of soil layers used to size arrays." inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="ISWWAT" description="Water-limited flag (&quot;Y&quot; for water-limited)." inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="BD" description="Bulk density per soil layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DLAYR" description="Thickness of each soil layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DS" description="Cumulative depth to bottom of each soil layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DUL" description="Drained upper limit volumetric water content per layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="LL" description="Lower limit volumetric water content per layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="NLAYR" description="Actual number of soil layers used." inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="MSALB" description="Soil albedo." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SW" description="Volumetric soil water content per layer." inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="XLAT" description="Latitude used to choose harvest day anchor." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SRAD" description="Daily solar radiation." inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TAVG" description="Average daily air temperature." inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TMAX" description="Maximum daily air temperature." inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TAV" description="Average annual soil temperature." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TAMP" description="Amplitude of the seasonal soil temperature function." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DOY" description="Day of year." inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="CUMDPT" description="Cumulative profile depth used for layer midpoints." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DSMID" description="Depth to the midpoint of each soil layer." inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="NL" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TDL" description="Total drained upper limit integrated across layers (accumulated)." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TMA" description="Moving array of last 5 days of average soil temperatures." inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="ATOT" description="Running total (sum) of the TMA series." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SRFTEMP" description="Surface soil temperature." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="ST" description="Soil temperature by layer." inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="NL" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="HDAY" description="Anchor day for annual temperature cycle (20 if latitude &lt; 0, else 200)." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="CUMDPT" description="Cumulative profile depth used for layer midpoints (carried)." variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="-" uri="-"/>
		<Output name="DSMID" description="Depth to the midpoint of each soil layer (carried)." variablecategory="state" datatype="DOUBLEARRAY" len="NL" max="-" min="-" unit="-" uri="-"/>
		<Output name="TDL" description="Total drained upper limit integrated across layers (accumulated)." variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="-" uri="-"/>
		<Output name="TMA" description="Moving array of last 5 days of average soil temperatures (updated)." variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" unit="-" uri="-"/>
		<Output name="ATOT" description="Running total (sum) of the TMA series (updated)." variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="-" uri="-"/>
		<Output name="SRFTEMP" description="Surface soil temperature (updated)." variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="-" uri="-"/>
		<Output name="ST" description="Soil temperature by layer (updated)." variablecategory="state" datatype="DOUBLEARRAY" len="NL" max="-" min="-" unit="-" uri="-"/>
	</Outputs>
	<Initialization name="Init" language="cyml" filename="algo/pyx/Init.pyx"/>
	<Function name="SOILT" description="Supporting function computing soil temperatures, surface temperature, and updating moving averages." language="cyml" type="external" filename="algo/pyx/SOILT.pyx"/>
	<Function name="trunc" description="Helper to truncate a float to a fixed number of decimals; defined locally within Init and SOILT." language="cyml" type="external" filename="algo/pyx/trunc.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/CalculateModel.pyx"/>
	<Parametersets/>
	<Testsets>
		<Testset name="t_-" description="-">
			<Test name="t_-">
				<OutputValue name="-">-</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
