<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP – Soil temperature by layer (DSSAT component)" name="STEMP – Soil temperature by layer (DSSAT component)" timestep="1" version="1.0">
	<Description>
		<Title>STEMP – Soil temperature by layer (DSSAT component)</Title>
		<Authors>DSSAT Development Team; C.H. Porter; Gerrit Hoogenboom; A.J. Gijsman; P.W. Wilkens</Authors>
		<Institution>University of Georgia; University of Florida; Iowa State University; International Center for Soil Fertility and Agricultural Development (IFDC); University of Guelph</Institution>
		<URI>https://github.com/DSSAT/dssat-csm-os</URI>
		<Reference>https://doi.org/10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>STEMP computes daily soil temperature by layer within DSSAT/CSM using EPIC-inspired damping-depth physics and a sinusoidal seasonal forcing. It initializes layer midpoints and cumulative depth, derives bulk density and an effective water content function WC = max(0.01, PESW)/(WW*CUMDPT)*10, computes a damping depth DD = FX*DP with FX = exp(B*((1−WC)/(1+WC))^2), and updates temperatures as ST(L) = TAV + (TAMP/2*cos(ALX + ZD) + DT)*exp(ZD), where ALX is the seasonal phase, ZD = −DSMID(L)/DD, DT is the deviation of recent mean air temperature from the seasonal signal, and TAV/TAMP are long-term mean and amplitude. Surface temperature is calculated similarly. Inputs include radiation, air temperatures, latitude, soil water (or DUL if water is off), albedo (including mulch), and soil properties by layer. Output is daily surface and layer temperatures.</ExtendedDescription>
		<ShortDescription>Daily 1D soil thermal profile model computing surface and layered soil temperatures from weather, soil, and water inputs within DSSAT.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="ISWITCH_ISWWAT" description="Flag for soil water simulation ('Y' to use simulated water; otherwise use DUL)." inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_BD" description="Bulk density by layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="SOILPROP_DS" description="Cumulative depth to layer bottom by layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DUL" description="Drained upper limit (volumetric fraction) by layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="vol.frac" uri="-"/>
		<Input name="SOILPROP_LL" description="Lower limit (volumetric fraction) by layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="vol.frac" uri="-"/>
		<Input name="SOILPROP_NLAYR" description="Number of soil layers." inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="1" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_MSALB" description="Soil/mulch albedo used in temperature calculations." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="SRAD" description="Daily solar radiation (not used directly by core equations)." inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0" default="-" unit="MJ/m2/d" uri="-"/>
		<Input name="SW" description="Soil water content by layer (volumetric fraction)." inputtype="variable" variablecategory="exogenous" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="1" min="0" default="-" unit="vol.frac" uri="-"/>
		<Input name="TAVG" description="Daily average air temperature." inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TMAX" description="Daily maximum air temperature (not used directly)." inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="XLAT" description="Latitude; sign used to set hottest day in initialization." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="90" min="-90" default="-" unit="deg" uri="-"/>
		<Input name="TAV" description="Annual average air temperature." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TAMP" description="Annual temperature amplitude." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="0" default="-" unit="C" uri="-"/>
		<Input name="CONTROL_YRDOY" description="Date as YYYYDOY integer." inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="YYYYDOY" uri="-"/>
		<Input name="SOILPROP_DLAYR" description="Soil layer thickness by layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="CUMDPT" description="Cumulative profile depth." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="0" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to mid-point of each layer." inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="0" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Profile sum of DUL*layer_thickness (previous day)." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="Moving average queue (length 5) of daily TAVG." inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="ATOT" description="Sum of TMA queue values." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="SRFTEMP" description="Surface temperature (previous day)." inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="ST" description="Soil temperature by layer (previous day)." inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="HDAY" description="Hottest day-of-year phase anchor." inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="366" min="1" default="-" unit="doy" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="TDL" description="Profile sum of DUL*layer_thickness (for the day)." variablecategory="state" datatype="DOUBLE" max="-" min="0" unit="cm" uri="-"/>
		<Output name="TMA" description="Updated moving average queue (length 5) of TAVG." variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" unit="C" uri="-"/>
		<Output name="ATOT" description="Updated sum of TMA queue." variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="C" uri="-"/>
		<Output name="SRFTEMP" description="Updated surface temperature." variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="C" uri="-"/>
		<Output name="ST" description="Updated soil temperature by layer." variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" unit="C" uri="-"/>
	</Outputs>
	<Initialization name="STEMP_Initialize" language="cyml" filename="algo/pyx/STEMP_Initialize.pyx"/>
	<Function name="YR_DOY" description="Convert YYYYDOY integer to (year, day-of-year)." language="cyml" type="external" filename="algo/pyx/YR_DOY.pyx"/>
	<Function name="_nint" description="Fortran-like nearest-integer (NINT), halves away from zero." language="cyml" type="external" filename="algo/pyx/_nint.pyx"/>
	<Function name="_round_nint_decimals" description="Fortran-like rounding using NINT at specified decimals." language="cyml" type="external" filename="algo/pyx/_round_nint_decimals.pyx"/>
	<Function name="SOILT" description="Soil temperature by layer (daily) core calculation called by STEMP." language="cyml" type="external" filename="algo/pyx/SOILT.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP.pyx"/>
	<Parametersets/>
	<Testsets>
		<Testset name="t_-" description="-">
			<Test name="t_-">
				<OutputValue name="-">-</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
