<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP" name="STEMP" timestep="1" version="1.0">
	<Description>
		<Title>STEMP</Title>
		<Authors>DSSAT (DSSAT Florida)</Authors>
		<Institution>University of Georgia; University of Florida; Iowa State University; International Center for Soil Fertility and Agricultural Development (IFDC); University of Guelph</Institution>
		<URI>-</URI>
		<Reference>https://doi.org/10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Computes daily soil temperature by layer (ST) and surface temperature (SRFTEMP) using an EPIC/Partonâ€“Logan-based approach. Initializes layer depths and a 5-day moving average, derives damping depth from bulk density and soil water, applies albedo (including mulch/soil moisture effects), and updates temperatures with weather (TAVG, TMAX, SRAD), latitude, and climatology (TAV, TAMP). Designed for DSSAT and optionally couples to soil water status (ISWWAT).</ExtendedDescription>
		<ShortDescription>Determines daily soil temperature by layer and surface temperature.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="CONTROL_DYNAMIC" description="Dynamic phase flag (e.g., 2=SEASINIT, 3=RATE)" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="CONTROL_YRDOY" description="Calendar date as YYYYDDD" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="CONTROL_RUN" description="Run number (used to gate initialization)" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="CONTROL_RNMODE" description="Run mode character flag" inputtype="variable" variablecategory="exogenous" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="ISWITCH_ISWWAT" description="Water switch ('Y' or 'N') controlling PESW source" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="Y" unit="-" uri="-"/>
		<Input name="SOILPROP_BD" description="Soil bulk density by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="SOILPROP_DLAYR" description="Soil layer thickness" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DS" description="Cumulative depth to bottom of each layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DUL" description="Drained upper limit (field capacity) by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_LL" description="Lower limit by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="1" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_MSALB" description="Soil/mulch albedo" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="SRAD" description="Daily solar radiation (not used in core soil temperature equations here)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="MJ/m2-d" uri="-"/>
		<Input name="SW" description="Volumetric soil water content by layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="1" min="0" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="TAVG" description="Average daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMAX" description="Maximum daily air temperature (not used in core soil temperature equations here)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="XLAT" description="Latitude (used to set hottest day of year)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="90" min="-90" default="-" unit="deg" uri="-"/>
		<Input name="TAV" description="Average annual soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TAMP" description="Amplitude of soil temperature annual cycle" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="CUMDPT" description="Cumulative depth of soil profile" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="0" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to midpoint of soil layer" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="0" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Total water at DUL over the profile" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="Previous 5 days of average soil temperatures (moving window)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ATOT" description="Sum of last 5 days of average soil temperatures" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="SRFTEMP" description="Soil surface temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ALBEDO" description="Effective surface albedo passed to soil temperature routine" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="B" description="Empirical coefficient for damping depth calculation" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DOY" description="Day of year derived from CONTROL_YRDOY" inputtype="variable" variablecategory="auxiliary" datatype="INT" max="366" min="1" default="-" unit="-" uri="-"/>
		<Input name="DP" description="Damping depth for soil temperature waves" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="mm" uri="-"/>
		<Input name="HDAY" description="Hottest day of year based on latitude" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="366" min="1" default="-" unit="day" uri="-"/>
		<Input name="NLAYR" description="Number of layers used in calculations (copy of SOILPROP_NLAYR)" inputtype="variable" variablecategory="auxiliary" datatype="INT" max="-" min="1" default="-" unit="-" uri="-"/>
		<Input name="PESW" description="Plant-extractable soil water over the profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="WW" description="Fractional water content at saturation proxy used in WC function" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="CUMDPT" description="Updated cumulative depth of soil profile" variablecategory="state" datatype="DOUBLE" max="-" min="0" unit="mm" uri="-"/>
		<Output name="DSMID" description="Updated depth to midpoint of soil layer" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="0" unit="mm" uri="-"/>
		<Output name="TDL" description="Updated total water at DUL over the profile" variablecategory="state" datatype="DOUBLE" max="-" min="0" unit="cm" uri="-"/>
		<Output name="TMA" description="Updated 5-day moving window of average soil temperatures" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ATOT" description="Updated sum of last 5 days of average soil temperatures" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="SRFTEMP" description="Updated soil surface temperature" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ST" description="Updated soil temperature by layer" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" unit="degC" uri="-"/>
	</Outputs>
	<Initialization name="STEMP" language="cyml" filename="algo/pyx/STEMP.pyx"/>
	<Function name="YR_DOY" description="Converts YRDOY (YYYYDDD) to (YR, DOY)." language="cyml" type="external" filename="algo/pyx/YR_DOY.pyx"/>
	<Function name="_nint" description="Nearest-integer rounding with halves away from zero." language="cyml" type="external" filename="algo/pyx/_nint.pyx"/>
	<Function name="SOILT" description="Computes soil temperature profile and surface temperature, updating moving averages." language="cyml" type="external" filename="algo/pyx/SOILT.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP.pyx"/>
	<Parametersets/>
	<Testsets/>
</ModelUnit>
