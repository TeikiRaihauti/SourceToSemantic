<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP" name="STEMP" timestep="1" version="1.0">
	<Description>
		<Title>STEMP</Title>
		<Authors>DSSAT (DSSAT Florida)</Authors>
		<Institution>The University of Georgia, Griffin, Georgia; University of Florida, Gainesville, Florida; Iowa State University, Ames, Iowa; International Center for Soil Fertility and Agricultural Development, Muscle Shoals, Alabama; University of Guelph, Guelph, Ontario</Institution>
		<URI>-</URI>
		<Reference>10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Computes daily soil temperature by layer using an EPIC/Partonâ€“Logan based approach. It updates surface and layer temperatures from bulk density, soil water, albedo, latitude, and annual mean/amplitude, using a damping depth that responds to soil physical conditions.</ExtendedDescription>
		<ShortDescription>Determines soil temperature by layer.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="CONTROL_YRDOY" description="Current date as YYYYDDD integer" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="YYYYDDD" uri="-"/>
		<Input name="ISWITCH_ISWWAT" description="Water stress switch ('Y' uses actual water, 'N' uses DUL)" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="Y/N" unit="-" uri="-"/>
		<Input name="SOILPROP_BD" description="Bulk density per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="SOILPROP_DLAYR" description="Layer thickness" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DS" description="Cumulative depth to bottom of each layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DUL" description="Volumetric soil water content at DUL per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_LL" description="Volumetric soil water content at lower limit per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="1" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_MSALB" description="Mulch/soil albedo" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SRAD" description="Solar radiation" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="MJ/m2-d" uri="-"/>
		<Input name="SW" description="Volumetric soil water content per layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="TAVG" description="Average daily temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMAX" description="Maximum daily temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="XLAT" description="Latitude (negative for southern hemisphere)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="90" min="-90" default="-" unit="deg" uri="-"/>
		<Input name="TAV" description="Average annual soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TAMP" description="Amplitude of soil temperature function" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="CUMDPT" description="Cumulative depth of soil profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to midpoint of soil layers" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Total water content at drained upper limit over profile" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="Previous 5 days average soil temperatures" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ATOT" description="Sum of last 5 days average soil temperatures" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="SRFTEMP" description="Soil surface temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="DOY" description="Day of year derived from CONTROL_YRDOY" inputtype="variable" variablecategory="auxiliary" datatype="INT" max="366" min="1" default="-" unit="day" uri="-"/>
		<Input name="HDAY" description="Hottest day-of-year (hemisphere-dependent)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="20 (south), 200 (north)" unit="day" uri="-"/>
		<Input name="ABD" description="Average bulk density over profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DP" description="Damping depth" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="WW" description="Soil water content effect coefficient" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="B" description="Attenuation factor parameter" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="PESW" description="Plant extractable soil water over profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="ALBEDO" description="Soil albedo passed to SOILT" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="TDL" description="Updated total water content at DUL over profile" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="cm" uri="-"/>
		<Output name="TMA" description="Updated previous 5 days average soil temperatures" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ATOT" description="Updated sum of last 5 days average soil temperatures" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="SRFTEMP" description="Updated soil surface temperature" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ST" description="Updated soil temperature by layer" variablecategory="state" datatype="DOUBLELIST" len="SOILPROP_NLAYR" max="-" min="-" unit="degC" uri="-"/>
	</Outputs>
	<Initialization name="STEMP_Initialize" language="cyml" filename="algo/pyx/STEMP_Initialize.pyx"/>
	<Function name="YR_DOY" description="Converts YRDOY (YYYYDDD) to (YEAR, DOY)." language="cyml" type="external" filename="algo/pyx/YR_DOY.pyx"/>
	<Function name="_round_half_away_from_zero" description="Fortran-like rounding to nearest with ties away from zero." language="cyml" type="external" filename="algo/pyx/_round_half_away_from_zero.pyx"/>
	<Function name="SOILT" description="Determines soil temperature by layer." language="cyml" type="external" filename="algo/pyx/SOILT.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STEMP_initialization_and_rate" description="Derived test from ASKEE example values. Checks shapes and basic consistency.">
			<Param name="ISWITCH_ISWWAT">Y</Param>
			<Param name="SOILPROP_NLAYR">4</Param>
			<Param name="SOILPROP_BD">[1.6, 1.6, 1.6, 1.6]</Param>
			<Param name="SOILPROP_DLAYR">[10.0, 10.0, 10.0, 10.0]</Param>
			<Param name="SOILPROP_DS">[10.0, 20.0, 30.0, 40.0]</Param>
			<Param name="SOILPROP_DUL">[0.3, 0.3, 0.3, 0.3]</Param>
			<Param name="SOILPROP_LL">[0.2, 0.2, 0.2, 0.2]</Param>
			<Param name="SOILPROP_MSALB">0.13</Param>
			<Param name="XLAT">28.0</Param>
			<Param name="TAV">20.0</Param>
			<Param name="TAMP">10.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STEMP_initialization_and_rate" description="Derived test from ASKEE example values. Checks shapes and basic consistency." parameterset="p_test_STEMP_initialization_and_rate">
			<Test name="t_test_STEMP_initialization_and_rate">
				<InputValue name="CONTROL_YRDOY">2021100</InputValue>
				<InputValue name="SRAD">20.0</InputValue>
				<InputValue name="SW">[0.2, 0.2, 0.2, 0.2]</InputValue>
				<InputValue name="TAVG">25.0</InputValue>
				<InputValue name="TMAX">30.0</InputValue>
				<OutputValue name="DSMID">[50.0, 150.0, 250.0, 350.0]</OutputValue>
				<OutputValue name="CUMDPT">400.0</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
