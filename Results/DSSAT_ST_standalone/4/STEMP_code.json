{
    "init": {
        "name": "STEMP_Initialize"
    },
    "process": {
        "name": "STEMP",
        "description": "Daily soil temperature process (EPIC-based), updating rolling temperature memory and computing surface and layer temperatures."
    },
    "inputs": [
        {
            "name": "CONTROL_YRDOY",
            "description": "Combined year and day-of-year as YYYY*1000 + DOY",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "ISWITCH_ISWWAT",
            "description": "Switch to use water balance (Y) or not (N) for plant-extractable soil water (PESW)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "SOILPROP_BD",
            "description": "Soil bulk density by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "g cm-3",
            "uri": ""
        },
        {
            "name": "SOILPROP_DLAYR",
            "description": "Soil layer thickness by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": ""
        },
        {
            "name": "SOILPROP_DS",
            "description": "Depth to bottom of each soil layer (cumulative)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": ""
        },
        {
            "name": "SOILPROP_DUL",
            "description": "Volumetric water content at drained upper limit by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "cm3 cm-3",
            "uri": ""
        },
        {
            "name": "SOILPROP_LL",
            "description": "Volumetric water content at lower limit by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "cm3 cm-3",
            "uri": ""
        },
        {
            "name": "SOILPROP_NLAYR",
            "description": "Number of soil layers",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "SOILPROP_MSALB",
            "description": "Minimum soil albedo (fraction)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "SRAD",
            "description": "Daily solar radiation",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "SW",
            "description": "Soil water content by layer (can be scalar or per layer)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "cm3 cm-3",
            "uri": ""
        },
        {
            "name": "TAVG",
            "description": "Daily average air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "TMAX",
            "description": "Daily maximum air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "XLAT",
            "description": "Latitude",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90",
            "max": "90",
            "default": "-",
            "unit": "degrees",
            "uri": ""
        },
        {
            "name": "TAV",
            "description": "Mean annual air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "TAMP",
            "description": "Annual amplitude of air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "HDAY",
            "description": "Hemisphere day offset (seasonal phase shift)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "day-of-year",
            "uri": ""
        },
        {
            "name": "CUMDPT",
            "description": "Cumulative soil profile depth",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "DSMID",
            "description": "Depth to midpoint of each soil layer",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "SOILPROP_NLAYR",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "TMA",
            "description": "Rolling memory of the last 5 daily average temperatures",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "5",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "ATOT",
            "description": "Sum of rolling memory temperatures (TMA)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "YRDOY",
            "description": "Year-day composite used by YR_DOY",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "DOY",
            "description": "Day of year (1-366) derived from YRDOY",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "ALBEDO",
            "description": "Soil albedo passed to SOILT (set from MSALB)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "B",
            "description": "Damping coefficient for thermal wave",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "DP",
            "description": "Damping depth for temperature wave",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "NLAYR",
            "description": "Number of layers as used within SOILT",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "PESW",
            "description": "Plant-extractable soil water in profile",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": ""
        },
        {
            "name": "WW",
            "description": "Affecting soil heat capacity term (texture-dependent factor)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        }
    ],
    "outputs": [
        {
            "name": "CUMDPT",
            "description": "Cumulative soil profile depth (carried forward)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "DSMID",
            "description": "Depth to the midpoint of each soil layer (carried forward)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "SOILPROP_NLAYR",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "TDL_local",
            "description": "Profile water at drained upper limit (sum over layers)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": ""
        },
        {
            "name": "TMA_new",
            "description": "Updated 5-day rolling memory of average air temperature",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "5",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "ATOT_new",
            "description": "Updated sum of rolling memory temperatures (TMA)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "SRFTEMP",
            "description": "Computed surface soil temperature",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        },
        {
            "name": "ST",
            "description": "Computed soil temperature by layer",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "SOILPROP_NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": ""
        }
    ],
    "functions": [
        {
            "name": "_nint",
            "description": "Nearest-integer rounding returning float."
        },
        {
            "name": "YR_DOY",
            "description": "Split composite YRDOY into year and day-of-year."
        },
        {
            "name": "SOILT",
            "description": "Compute surface and layered soil temperatures using EPIC method and rolling temperature memory."
        }
    ],
    "tests": [
        {
            "name": "test_STEMP_example",
            "description": "Initialization and one-step run; checks shapes and invariants.",
            "inputs": [
                {
                    "name": "CONTROL_YRDOY",
                    "value": 2021100
                },
                {
                    "name": "ISWITCH_ISWWAT",
                    "value": "Y"
                },
                {
                    "name": "NLAYR",
                    "value": 4
                },
                {
                    "name": "SOILPROP_BD",
                    "value": [
                        1.6,
                        1.6,
                        1.6,
                        1.6
                    ]
                },
                {
                    "name": "SOILPROP_DLAYR",
                    "value": [
                        10.0,
                        10.0,
                        10.0,
                        10.0
                    ]
                },
                {
                    "name": "SOILPROP_DS",
                    "value": [
                        10.0,
                        20.0,
                        30.0,
                        40.0
                    ]
                },
                {
                    "name": "SOILPROP_DUL",
                    "value": [
                        0.3,
                        0.3,
                        0.3,
                        0.3
                    ]
                },
                {
                    "name": "SOILPROP_LL",
                    "value": [
                        0.2,
                        0.2,
                        0.2,
                        0.2
                    ]
                },
                {
                    "name": "SOILPROP_NLAYR",
                    "value": 4
                },
                {
                    "name": "SOILPROP_MSALB",
                    "value": 0.13
                },
                {
                    "name": "SRAD",
                    "value": 20.0
                },
                {
                    "name": "SW",
                    "value": [
                        0.2,
                        0.2,
                        0.2,
                        0.2
                    ]
                },
                {
                    "name": "TAVG",
                    "value": 25.0
                },
                {
                    "name": "TMAX",
                    "value": 30.0
                },
                {
                    "name": "XLAT",
                    "value": 28.0
                },
                {
                    "name": "TAV",
                    "value": 20.0
                },
                {
                    "name": "TAMP",
                    "value": 10.0
                }
            ],
            "outputs": [
                {
                    "name": "DSMID_length",
                    "value": 4
                },
                {
                    "name": "ST_length",
                    "value": 4
                },
                {
                    "name": "TMA_length",
                    "value": 5
                },
                {
                    "name": "CUMDPT2_equals_CUMDPT",
                    "value": true
                },
                {
                    "name": "DSMID2_equals_DSMID",
                    "value": true
                },
                {
                    "name": "ST2_length",
                    "value": 4
                },
                {
                    "name": "TMA2_length",
                    "value": 5
                }
            ]
        }
    ]
}