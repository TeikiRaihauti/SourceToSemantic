<?xml version="1.0" ?>
<ModelUnit modelid=".Soil temperature model" name="Soil temperature model" timestep="1" version="1.0">
	<Description>
		<Title>Soil temperature model</Title>
		<Authors>STICS</Authors>
		<Institution>INRAE</Institution>
		<URI>-</URI>
		<Reference>http://dx.doi.org/10.1016/j.agrformet.2014.05.002</Reference>
		<ExtendedDescription>This component computes daily soil temperature dynamics. It derives canopy temperature amplitude from minimum and maximum canopy temperatures and the canopy mean temperature, then updates a 1-cm resolution soil temperature profile using an exponentially damped signal with depth based on diurnal frequency and soil thermal diffusivity. The profile is advanced using the previous day's profile and canopy temperature together with current minimum air temperature. Layer mean temperatures are obtained by averaging the 1-cm profile over user-defined soil layer thicknesses. The component provides initialization from an initial air temperature and updates the previous-day states at the end of each time step.</ExtendedDescription>
		<ShortDescription>Daily soil temperature profile and layer means driven by canopy and air temperatures with initialization and state update.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="air_temp_day1" description="Mean temperature on first day (degC)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="canopy_temp_avg" description="Current canopy mean temperature (degC)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="layer_thick" description="List of layer thicknesses (cm)" inputtype="parameter" parametercategory="constant" datatype="INTARRAY" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="layer_thick_or_depth" description="List of layer thicknesses or depths (cm) used to count non-zero layers" inputtype="parameter" parametercategory="constant" datatype="INTARRAY" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="max_canopy_temp" description="Current maximum canopy temperature (degC)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="max_temp" description="Current maximum temperature (degC) used for amplitude" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="min_air_temp" description="Current minimum air temperature (degC)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="min_canopy_temp" description="Current minimum canopy temperature (degC)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="min_temp" description="Current minimum temperature (degC) used for amplitude" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="prev_canopy_temp" description="Previous canopy temperature (degC)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="prev_temp_profile" description="Previous soil temperature profile per 1-cm layer (degC)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="sum(layer_thick)" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="temp_amp" description="Current temperature amplitude (degC)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="temp_profile" description="Current soil temperature profile per 1-cm layer (degC)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="sum(layer_thick)" max="-" min="-" default="-" unit="degC" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="prev_temp_profile" description="Updated previous soil temperature profile per 1-cm layer (degC)" variablecategory="state" datatype="DOUBLEARRAY" len="sum(layer_thick)" max="-" min="-" unit="degC" uri="-"/>
		<Output name="prev_canopy_temp" description="Updated previous canopy temperature (degC)" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
	</Outputs>
	<Initialization name="init_temp_profile" language="cyml" filename="algo/pyx/init_temp_profile.pyx"/>
	<Function name="model_temp_amp" description="Calculates temperature amplitude." language="cyml" type="external" filename="algo/pyx/model_temp_amp.pyx"/>
	<Function name="model_canopy_temp_avg" description="Calculates canopy temperature average." language="cyml" type="external" filename="algo/pyx/model_canopy_temp_avg.pyx"/>
	<Function name="layer_thickness2depth" description="Converts layer thicknesses to cumulative depths." language="cyml" type="external" filename="algo/pyx/layer_thickness2depth.pyx"/>
	<Function name="get_soil_depth" description="Computes total soil depth (sum of layer thicknesses)." language="cyml" type="external" filename="algo/pyx/get_soil_depth.pyx"/>
	<Function name="get_layers_number" description="Counts the number of non-zero layers." language="cyml" type="external" filename="algo/pyx/get_layers_number.pyx"/>
	<Function name="model_layers_temp" description="Calculates soil layers mean temperature from the 1-cm temperature profile." language="cyml" type="external" filename="algo/pyx/model_layers_temp.pyx"/>
	<Function name="model_temp_profile" description="Calculates soil temperature profile for 1-cm layers." language="cyml" type="external" filename="algo/pyx/model_temp_profile.pyx"/>
	<Function name="model_update" description="Updates previous state variables." language="cyml" type="external" filename="algo/pyx/model_update.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/model_soil_temp.pyx"/>
	<Parametersets/>
	<Testsets>
		<Testset name="t_-" description="-">
			<Test name="t_-">
				<OutputValue name="-">-</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
