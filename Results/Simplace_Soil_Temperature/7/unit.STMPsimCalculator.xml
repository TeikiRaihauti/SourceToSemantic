<?xml version="1.0" ?>
<ModelUnit modelid=".STMPsimCalculator (Soil Temperature Model)" name="STMPsimCalculator (Soil Temperature Model)" timestep="1" version="-">
	<Description>
		<Title>STMPsimCalculator (Soil Temperature Model)</Title>
		<Authors>Andreas Enders; Gunther Krauss</Authors>
		<Institution>Crop Science Group, Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>net.simplace.sim.components.soil.temperature.STMPsimCalculator</URI>
		<Reference>-</Reference>
		<ExtendedDescription>STMPsimCalculator computes daily soil temperature in multiple soil layers following the APEX STMP formulation (Williams &amp; Izaurralde, 2005). Initialization extends the soil profile down to the damping depth and linearly interpolates temperatures from the first-day mean air temperature at the surface to the long-term mean air temperature (AVT) at depth. Each day, layer temperatures are updated with a lag (LAG=0.8) toward a depth-weighted combination of the current soil surface temperature (DST0) and AVT. The damping depth (DD) varies with average bulk density (ABD) and current profile water content (ST). Inputs include layer depths, first-day mean air temperature, AVT, ABD, initial damping depth, profile water content, and soil surface temperature (often provided by SnowCoverCalculator). Outputs are the layer-wise soil temperature array and its daily change; an extended layer-depth array is also maintained. Designed for use within the SIMPLACE framework.</ExtendedDescription>
		<ShortDescription>Daily multi-layer soil temperature model (APEX STMP) within SIMPLACE.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depths to the bottom of each soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="m" uri=""/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="cAVT" description="Long-term average annual air temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="cDampingDepth" description="Initial damping depth of soil" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="m" uri=""/>
		<Input name="cABD" description="Average soil bulk density of the profile" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="t m-3" uri=""/>
		<Input name="iSoilWaterContent" description="Water stored in the profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="mm" uri=""/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="iDoInitialize" description="If true, re-initialize the model before processing this time step" inputtype="variable" variablecategory="exogenous" datatype="INT" max="" min="" default="" unit="-" uri=""/>
		<Input name="pSoilLayerDepth" description="Layer bottom depths including added layers to reach damping depth" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="m" uri=""/>
		<Input name="SoilTempArray" description="Soil temperatures per layer from previous day" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="degC" uri=""/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperatures per layer" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" unit="degC" uri=""/>
		<Output name="pSoilLayerDepth" description="Layer bottom depths including added layers to reach damping depth (possibly re-initialized)" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" unit="m" uri=""/>
	</Outputs>
	<Initialization name="STMPsimCalculator_init" language="cyml" filename="algo/pyx/STMPsimCalculator_init.pyx"/>
	<Function name="-" description="-" language="cyml" type="external" filename="algo/pyx/-.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STMPsimCalculator_process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Derived from STMPsimCalculator.fillTestVariables case 0; initializes then processes one step and checks soil temperature profile.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Derived from STMPsimCalculator.fillTestVariables case 0; initializes then processes one step and checks soil temperature profile." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">False</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
