<?xml version="1.0" ?>
<ModelUnit modelid=".STMPsimCalculator (SIMPLACE Soil Temperature Model)" name="STMPsimCalculator (SIMPLACE Soil Temperature Model)" timestep="1" version="-">
	<Description>
		<Title>STMPsimCalculator (SIMPLACE Soil Temperature Model)</Title>
		<Authors>Gunther Krauss; Andreas Enders</Authors>
		<Institution>Crop Science Group, University of Bonn (INRES), Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>http://www.simplace.net</URI>
		<Reference>-</Reference>
		<ExtendedDescription>STMPsimCalculator is a SIMPLACE component that simulates daily soil temperature in multiple layers following the APEX STMP approach (Williams &amp; Izaurralde, 2005). The model updates soil temperature as STMP = LAG*STMP0 + (1−LAG)*(FZ*(AVT−DST0)+DST0), with a default lag LAG=0.8. Depth effect FZ depends on layer mid-depth and the damping depth (DD). DD is computed from average bulk density (ABD) and soil water content (WC) via DP = 1 + 2.5*ABD/(ABD + exp(6.53−5.63*ABD)), WC = 0.001*ST/(Z(n)*(0.356−0.144*ABD)), and DD = exp(ln(0.5/DP)*((1−WC)/(1+WC))*2)*DP. Bare surface temperature DST is estimated from daily air temperature and radiation, while the effective surface temperature DST0 (used to drive the profile) is provided by the coupled SnowCoverCalculator component to account for residue and snow cover. Initialization linearly interpolates between the first-day mean air temperature and the deep-layer average temperature (AVT) and extends layers to the damping depth if needed. State outputs are the soil temperature profile (SoilTempArray) and daily changes (rSoilTempArrayRate). Licensed under GNU LGPL v3. Reference: Williams, J.R., Izaurralde, C.A. (2005). The APEX model, Blackland Research Center Reports, Vol. 2, USDA, Temple, Texas, USA. Project site and documentation: http://www.simplace.net</ExtendedDescription>
		<ShortDescription>APEX-based multi-layer soil temperature component in SIMPLACE with damping depth and snow/residue effects via SnowCoverCalculator.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depth of soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="20" min="0.03" default="-" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="50" min="-40" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="cAVT" description="Constant temperature at damping depth (long-term mean air temperature)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="20" min="-10" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="cABD" description="Mean bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="4" min="1" default="2" unit="t m-3" uri="http://www.wurvoc.org/vocabularies/om-1.8/tonne_per_cubic_metre"/>
		<Input name="cDampingDepth" description="Initial value for damping depth of soil" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="20" min="1.5" default="6" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
		<Input name="iDoInitialize" description="Switch to re-initialize the model with initial values (0/1)" inputtype="variable" variablecategory="exogenous" datatype="INT" max="1" min="0" default="0" unit="-" uri="http://www.wurvoc.org/vocabularies/om-1.8/one"/>
		<Input name="iSoilWaterContent" description="Water content, sum of whole soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="20" min="1.5" default="5" unit="mm" uri="http://www.wurvoc.org/vocabularies/om-1.8/millimetre"/>
		<Input name="iSoilSurfaceTemperature" description="Temperature at soil surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="20" min="1.5" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="SoilTempArray" description="Array of soil temperatures in layers" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="50" min="-40" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="rSoilTempArrayRate" description="Array of daily temperature change" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="20" min="-20" default="-" unit="degC d-1" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius_per_day"/>
		<Input name="pSoilLayerDepth" description="Depth of soil layer plus additional depth" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="20" min="0.03" default="-" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperatures per layer" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="50" min="-40" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Output name="rSoilTempArrayRate" description="Updated daily soil temperature change per layer" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="20" min="-20" unit="degC d-1" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius_per_day"/>
		<Output name="pSoilLayerDepth" description="Depth to bottom of each (including added) layer (re-initialized if requested)" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="20" min="0.03" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
	</Outputs>
	<Initialization name="init" language="cyml" filename="algo/pyx/init.pyx"/>
	<Function name="reInitialize" description="Re-initialize state by calling init()." language="cyml" type="external" filename="algo/pyx/reInitialize.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Initialize then process one step; verify SoilTempArray.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Initialize then process one step; verify SoilTempArray." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">0</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
