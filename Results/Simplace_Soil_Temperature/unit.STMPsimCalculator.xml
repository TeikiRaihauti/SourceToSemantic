<?xml version="1.0" ?>
<ModelUnit modelid=".STMP Soil Temperature (SIMPLACE STMPsimCalculator)" name="STMP Soil Temperature (SIMPLACE STMPsimCalculator)" timestep="1" version="-">
	<Description>
		<Title>STMP Soil Temperature (SIMPLACE STMPsimCalculator)</Title>
		<Authors>Andreas Enders; Gunther Krauss</Authors>
		<Institution>Crop Science Group, University of Bonn, Germany</Institution>
		<URI>http://www.simplace.net</URI>
		<Reference>-</Reference>
		<ExtendedDescription>STMPsimCalculator is a SIMPLACE component that simulates daily soil temperature by layer using the APEX-based STMP formulation. It updates each layer’s temperature via a lagged combination of the previous day and a depth-weighted approach: STMP = LAG * STMP0 + (1−LAG) * (FZ * (AVT − DST0) + DST0), where FZ depends on layer midpoint depth relative to a dynamically computed damping depth (DD). DD is estimated from average soil bulk density (ABD) and soil water content, following APEX equations. The surface temperature (DST0) is provided by the coupled SnowCoverCalculator, which accounts for residue/snow insulation. Initialization linearly interpolates temperatures from a first-day mean air temperature at the surface to the long-term average air temperature (AVT) at the damping depth, adding virtual layers down to DD. Reference: Williams &amp; Izaurralde (2005), The APEX model.</ExtendedDescription>
		<ShortDescription>APEX-based multi-layer soil temperature module for SIMPLACE, using damping depth and surface temperature (with snow/residue effects) to update daily temperatures by depth.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depth of soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="20" min="0.03" default="-" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="50" min="-40" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="cAVT" description="Constant temperature of deepest soil layer (use long-term mean air temperature)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="20" min="-10" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="cABD" description="Mean bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="4" min="1" default="2" unit="t m-3" uri="http://www.wurvoc.org/vocabularies/om-1.8/tonne_per_cubic_metre"/>
		<Input name="cDampingDepth" description="Initial value for damping depth of soil" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="20" min="1.5" default="6" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
		<Input name="iDoInitialize" description="Switch to re-initialize the model with initial values (0/1)" inputtype="variable" variablecategory="exogenous" datatype="INT" max="1" min="0" default="0" unit="-" uri="http://www.wurvoc.org/vocabularies/om-1.8/one"/>
		<Input name="iSoilWaterContent" description="Water content, sum of whole soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="20" min="1.5" default="5" unit="mm" uri="http://www.wurvoc.org/vocabularies/om-1.8/millimetre"/>
		<Input name="iSoilSurfaceTemperature" description="Temperature at soil surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="20" min="1.5" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="SoilTempArray" description="Array of soil temperatures in layers" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="50" min="-40" default="-" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Input name="rSoilTempArrayRate" description="Array of daily temperature change" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="20" min="-20" default="-" unit="degC d-1" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius_per_day"/>
		<Input name="pSoilLayerDepth" description="Depth of soil layer plus additional depth" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="20" min="0.03" default="-" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperature per layer" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="50" min="-40" unit="degC" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius"/>
		<Output name="rSoilTempArrayRate" description="Updated daily soil temperature change per layer" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="20" min="-20" unit="degC d-1" uri="http://www.wurvoc.org/vocabularies/om-1.8/degree_Celsius_per_day"/>
		<Output name="pSoilLayerDepth" description="Depth to bottom of each (including added) soil layer" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="20" min="0.03" unit="m" uri="http://www.wurvoc.org/vocabularies/om-1.8/metre"/>
	</Outputs>
	<Initialization name="init" language="cyml" filename="algo/pyx/init.pyx"/>
	<Function name="reInitialize" description="Re-initialize state by calling init() when requested." language="cyml" type="external" filename="algo/pyx/reInitialize.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Initializes then processes one day and checks SoilTempArray against expected values.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Initializes then processes one day and checks SoilTempArray against expected values." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">0</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
