<?xml version="1.0" ?>
<ModelUnit modelid=".STMPsimCalculator" name="STMPsimCalculator" timestep="1" version="-">
	<Description>
		<Title>STMPsimCalculator</Title>
		<Authors>Andreas Enders; Gunther Krauss</Authors>
		<Institution>Crop Science Group, Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>net.simplace.sim.components.soil.temperature.STMPsimCalculator</URI>
		<Reference>-</Reference>
		<ExtendedDescription>Implements the APEX STMP routine to compute daily soil temperatures for multiple layers using a lagged update toward the long-term mean air temperature (AVT) and a depth factor controlled by damping depth (function of bulk density and soil water). Initializes temperatures linearly between first-day mean air temperature and AVT down to the damping depth. Requires soil surface temperature (DST0), typically provided by the companion SnowCoverCalculator that accounts for residue/snow cover. Outputs per-layer temperatures and daily change rates; supports re-initialization.</ExtendedDescription>
		<ShortDescription>Layered soil temperature model (APEX STMP) with damping depth and surface temperature coupling.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="List of soil layer bottom depths" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day for initialization" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="cDampingDepth" description="Initial damping depth used for profile extension" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cAVT" description="Long-term average annual air temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="cABD" description="Average soil bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="t m-3" uri="-"/>
		<Input name="pSoilLayerDepth" description="Profile depths including additional layers up to damping depth" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="SoilTempArray" description="Current soil temperatures per layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature (DST0)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="iSoilWaterContent" description="Total soil water stored in profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="iDoInitialize" description="Flag to re-initialize before processing" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray_new" description="Updated soil temperatures per layer after the process step" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="degC" uri="-"/>
		<Output name="pSoilLayerDepth_proc" description="Profile depths after the process step (possibly re-initialized)" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="m" uri="-"/>
	</Outputs>
	<Initialization name="init" language="cyml" filename="algo/pyx/init.pyx"/>
	<Function name="-" description="-" language="cyml" type="external" filename="algo/pyx/-.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Initializes the component and runs one process step; checks SoilTempArray.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
			<Param name="iDoInitialize">False</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Initializes the component and runs one process step; checks SoilTempArray." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<OutputValue name="SoilTempArray_new">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
