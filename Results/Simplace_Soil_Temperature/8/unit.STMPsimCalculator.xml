<?xml version="1.0" ?>
<ModelUnit modelid=".SIMPLACE STMP Soil Temperature and Snow Cover Component" name="SIMPLACE STMP Soil Temperature and Snow Cover Component" timestep="1" version="-">
	<Description>
		<Title>SIMPLACE STMP Soil Temperature and Snow Cover Component</Title>
		<Authors>Andreas Enders; Gunther Krauss</Authors>
		<Institution>Crop Science Group, Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>http://www.simplace.net</URI>
		<Reference>-</Reference>
		<ExtendedDescription>Implements the APEX/STMP approach to simulate daily soil temperature across multiple soil layers, with optional coupling to a snow/residue surface module. Initialization extends layer depths to the damping depth and linearly interpolates temperatures between the first-day mean air temperature and the deep-layer average (AVT). Each day, temperatures are updated with a lagged scheme (LAG=0.8) using a depth factor relative to the damping depth (DD), where DD depends on bulk density and soil water content. The companion SnowCoverCalculator estimates soil surface temperature and snow dynamics (accumulation, melt, evaporation) via residue/snow isolation indices, providing the surface temperature input to STMP. Inputs include layer depths, AVT, bulk density, soil water content, meteorology, and surface temperature; outputs are per-layer soil temperatures and their daily changes.</ExtendedDescription>
		<ShortDescription>Daily multilayer soil temperature (APEX/STMP) with optional snow/residue effects on surface temperature.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="SoilTempArray" description="Current soil temperatures per layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="°C" uri=""/>
		<Input name="rSoilTempArrayRate" description="Rate of change from previous step" inputtype="variable" variablecategory="rate" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="°C/d" uri=""/>
		<Input name="pSoilLayerDepth" description="Depths to bottom of each layer including additional layers up to damping depth" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="m" uri=""/>
		<Input name="cSoilLayerDepth" description="Configured depths to bottom of each initial soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="" min="" default="" unit="m" uri=""/>
		<Input name="cABD" description="Mean bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="t m-3" uri=""/>
		<Input name="iSoilWaterContent" description="Water content summed over the soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="mm" uri=""/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="°C" uri=""/>
		<Input name="cAVT" description="Long-term average air temperature / deep soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="°C" uri=""/>
		<Input name="iDoInitialize" description="If True, re-initialize arrays using initial conditions before processing" inputtype="variable" variablecategory="exogenous" datatype="CHAR" max="" min="" default="" unit="-" uri=""/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day (used by initialization)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="°C" uri=""/>
		<Input name="cDampingDepth" description="Damping depth of soil" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="m" uri=""/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperatures per layer after the daily step" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" unit="°C" uri=""/>
		<Output name="pSoilLayerDepth" description="Layer depths to bottom of each layer after processing (may be unchanged)" variablecategory="state" datatype="DOUBLELIST" len="-" max="" min="" unit="m" uri=""/>
	</Outputs>
	<Initialization name="STMPsimCalculator_initialize" language="cyml" filename="algo/pyx/STMPsimCalculator_initialize.pyx"/>
	<Function name="-" description="-" language="cyml" type="external" filename="algo/pyx/-.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STMPsimCalculator_process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Derived from STMPsimCalculator.fillTestVariables test case aTestIndex == 0.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Derived from STMPsimCalculator.fillTestVariables test case aTestIndex == 0." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">False</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
