<?xml version="1.0" ?>
<ModelUnit modelid=".STMP Soil Temperature Calculator (SIMPLACE)" name="STMP Soil Temperature Calculator (SIMPLACE)" timestep="1" version="-">
	<Description>
		<Title>STMP Soil Temperature Calculator (SIMPLACE)</Title>
		<Authors>Andreas Enders; Gunther Krauss</Authors>
		<Institution>Crop Science Group, Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>http://www.simplace.net</URI>
		<Reference>-</Reference>
		<ExtendedDescription>SIMPLACE component that computes daily soil temperatures for multiple layers using the APEX STMP formulation. Temperatures are updated by weighting the previous day with a lag factor and combining soil surface temperature, depth, and a depth-dependent damping term that varies with bulk density and soil water content. Initialization linearly interpolates between the first-day mean air temperature and the long‑term average air temperature across the specified damping depth, extending layers as needed. The soil surface temperature input can be provided externally, e.g., by the companion SnowCoverCalculator that accounts for residue and snow cover effects.</ExtendedDescription>
		<ShortDescription>Multilayer soil temperature (STMP) simulator based on APEX equations, with optional coupling to a snow/cover surface-temperature module.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depths to the bottom of each soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day (used in initialization)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="cDampingDepth" description="Initial damping depth of soil (used in initialization)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cAVT" description="Constant temperature of deepest soil layer (long-term mean air temperature)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="cABD" description="Mean bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="t m-3" uri="-"/>
		<Input name="iSoilWaterContent" description="Water content of the whole soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="iDoInitialize" description="If true, re-initialize state before processing" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SoilTempArray" description="Soil temperatures in layers (previous step/state)" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="rSoilTempArrayRate" description="Daily temperature change per layer (previous step/state)" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="°C d-1" uri="-"/>
		<Input name="pSoilLayerDepth" description="Depth to bottom of soil layers including extensions (previous step/state)" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperatures in layers" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="°C" uri="-"/>
		<Output name="rSoilTempArrayRate" description="Updated daily temperature change per layer" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="°C d-1" uri="-"/>
		<Output name="pSoilLayerDepth" description="Depth to bottom of soil layers (unchanged)" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="m" uri="-"/>
	</Outputs>
	<Initialization name="STMPsimCalculator_init" language="cyml" filename="algo/pyx/STMPsimCalculator_init.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STMPsimCalculator_process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Derived test that initializes then processes one step and checks SoilTempArray against expected values.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Derived test that initializes then processes one step and checks SoilTempArray against expected values." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">False</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
