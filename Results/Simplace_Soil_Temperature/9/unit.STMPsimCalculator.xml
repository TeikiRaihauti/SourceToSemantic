<?xml version="1.0" ?>
<ModelUnit modelid=".STMPsimCalculator (SIMPLACE Soil Temperature Model)" name="STMPsimCalculator (SIMPLACE Soil Temperature Model)" timestep="1" version="-">
	<Description>
		<Title>STMPsimCalculator (SIMPLACE Soil Temperature Model)</Title>
		<Authors>Gunther Krauss; Andreas Enders</Authors>
		<Institution>Crop Science Group, University of Bonn (INRES), Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>http://www.simplace.net</URI>
		<Reference>-</Reference>
		<ExtendedDescription>STMPsimCalculator is a SIMPLACE component that simulates daily soil temperature in multiple layers following the APEX STMP approach (Williams &amp; Izaurralde, 2005). The model updates soil temperature as STMP = LAG*STMP0 + (1−LAG)*(FZ*(AVT−DST0)+DST0), with a default lag LAG=0.8. Depth effect FZ depends on layer mid-depth and the damping depth (DD). DD is computed from average bulk density (ABD) and soil water content (WC) via DP = 1 + 2.5*ABD/(ABD + exp(6.53−5.63*ABD)), WC = 0.001*ST/(Z(n)*(0.356−0.144*ABD)), and DD = exp(ln(0.5/DP)*((1−WC)/(1+WC))*2)*DP. Bare surface temperature DST is estimated from daily air temperature and radiation, while the effective surface temperature DST0 (used to drive the profile) is provided by the coupled SnowCoverCalculator component to account for residue and snow cover. Initialization linearly interpolates between the first-day mean air temperature and the deep-layer average temperature (AVT) and extends layers to the damping depth if needed. State outputs are the soil temperature profile (SoilTempArray) and daily changes (rSoilTempArrayRate). Licensed under GNU LGPL v3. Reference: Williams, J.R., Izaurralde, C.A. (2005). The APEX model, Blackland Research Center Reports, Vol. 2, USDA, Temple, Texas, USA. Project site and documentation: http://www.simplace.net</ExtendedDescription>
		<ShortDescription>APEX-based multi-layer soil temperature component in SIMPLACE with damping depth and snow/residue effects via SnowCoverCalculator.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depth to the bottom of each soil layer Z(l)" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on first day" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="cAVT" description="Long-term average annual air temperature (deepest soil layer temp)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="cDampingDepth" description="Damping depth of soil (also used for initialization)" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cABD" description="Average bulk density over all layers" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="t m-3" uri="-"/>
		<Input name="iSoilWaterContent" description="Soil water stored in the soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="SoilTempArray" description="Current soil temperature per layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="°C" uri="-"/>
		<Input name="rSoilTempArrayRate" description="Current daily temperature change rate per layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="°C d-1" uri="-"/>
		<Input name="pSoilLayerDepth" description="Depths to the bottom of the layers extended to damping depth" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="iDoInitialize" description="If True, re-initialize state before processing" inputtype="variable" variablecategory="exogenous" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperature per layer" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="°C" uri="-"/>
		<Output name="rSoilTempArrayRate" description="Updated daily temperature change rate per layer" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="°C d-1" uri="-"/>
		<Output name="pSoilLayerDepth" description="Layer depths (unchanged unless reinitialized)" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="m" uri="-"/>
	</Outputs>
	<Initialization name="init" language="cyml" filename="algo/pyx/init.pyx"/>
	<Function name="reInitialize" description="Re-initialize state using init." language="cyml" type="external" filename="algo/pyx/reInitialize.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Single day update test comparing SoilTempArray to expected values.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Single day update test comparing SoilTempArray to expected values." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">False</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
