<?xml version="1.0" ?>
<ModelUnit modelid=".STMP Soil Temperature (SIMPLACE)" name="STMP Soil Temperature (SIMPLACE)" timestep="1" version="-">
	<Description>
		<Title>STMP Soil Temperature (SIMPLACE)</Title>
		<Authors>Andreas Enders; Gunther Krauss</Authors>
		<Institution>Crop Science Group, Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>net.simplace.sim.components.soil.temperature.STMPsimCalculator</URI>
		<Reference>-</Reference>
		<ExtendedDescription>This SIMPLACE component simulates daily soil temperature profiles (STMP) across multiple soil layers using APEX-based formulations. Soil temperature is updated by lagging the previous dayâ€™s temperature and blending the soil surface temperature with a depth-dependent attenuation controlled by a dynamic damping depth that depends on bulk density and soil water content. The soil surface temperature is computed from daily air temperature extremes, global radiation, and albedo; when coupled with the SnowCoverCalculator, residue and snow cover modify the surface temperature via a cover-dependent lag factor, and snow dynamics (accumulation, melt, and evaporation) are simulated. The configuration (soiltemp.xml) links SnowCoverCalculator outputs (SoilSurfaceTemperature) to STMPsimCalculator, producing a coherent soil temperature profile for use in nutrient and hydrologic submodels.</ExtendedDescription>
		<ShortDescription>APEX-based multilayer soil temperature model with optional snow/residue surface effects (SIMPLACE).</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depths to the bottom of each native soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on the first day used for initialization" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="cDampingDepth" description="Thermal damping depth for soil temperature profile" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="cAVT" description="Long-term average annual air temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="cABD" description="Average soil bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="t m-3" uri="-"/>
		<Input name="iSoilWaterContent" description="Water stored in the soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="SoilTempArray" description="Soil temperature profile per layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="rSoilTempArrayRate" description="Rate of change of soil temperature per layer" inputtype="variable" variablecategory="rate" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="degC/day" uri="-"/>
		<Input name="pSoilLayerDepth" description="Depths to the bottom of each (possibly extended) soil layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="m" uri="-"/>
		<Input name="iDoInitialize" description="Flag to re-initialize state before processing (0/1)" inputtype="variable" variablecategory="exogenous" datatype="INT" max="1" min="0" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperature profile per layer after the time step" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="degC" uri="-"/>
		<Output name="pSoilLayerDepth" description="Updated depths to the bottom of each (possibly extended) soil layer" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="m" uri="-"/>
	</Outputs>
	<Initialization name="init" language="cyml" filename="algo/pyx/init.pyx"/>
	<Function name="-" description="-" language="cyml" type="external" filename="algo/pyx/-.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/process.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Validates one-step soil temperature update against expected profile without re-initialization.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Validates one-step soil temperature update against expected profile without re-initialization." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<InputValue name="iDoInitialize">False</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
