<?xml version="1.0" ?>
<ModelUnit modelid=".STMPsimCalculator" name="STMPsimCalculator" timestep="1" version="-">
	<Description>
		<Title>STMPsimCalculator</Title>
		<Authors>Andreas Enders, Gunther Krauss</Authors>
		<Institution>Crop Science Group, Katzenburgweg 5, 53115 Bonn, Germany</Institution>
		<URI>http://www.simplace.net</URI>
		<Reference>-</Reference>
		<ExtendedDescription>Simulates daily soil temperature at the center of multiple soil layers using the APEX STMP formulation. Damping depth is computed from bulk density and soil water content, and temperatures relax from the soil surface toward the long-term mean air temperature with a lag term. Initialization linearly interpolates between the first-day mean air temperature and AVT across the specified damping depth; the component expects a soil-surface temperature input (e.g., from SnowCoverCalculator) and outputs the multilayer soil temperature profile and daily change rates.</ExtendedDescription>
		<ShortDescription>Daily multilayer soil temperature model (APEX STMP) for SIMPLACE.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="cSoilLayerDepth" description="Depths to the bottom of each soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="0.0" default="-" unit="m" uri="-"/>
		<Input name="cFirstDayMeanTemp" description="Mean air temperature on the first day" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="cDampingDepth" description="Initial damping depth of soil" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="0.0" default="-" unit="m" uri="-"/>
		<Input name="cAVT" description="Constant temperature of deepest soil layer - long term mean air temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="cABD" description="Mean bulk density" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="t/m3" uri="-"/>
		<Input name="iSoilWaterContent" description="Water content, sum over whole soil profile" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0.0" default="-" unit="mm" uri="-"/>
		<Input name="iSoilSurfaceTemperature" description="Soil surface temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="iDoInitialize" description="If True, reinitialize the model state before processing the day" inputtype="parameter" parametercategory="constant" datatype="INT" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="SoilTempArray" description="Current soil temperature per layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="rSoilTempArrayRate" description="Current daily temperature change per layer" inputtype="variable" variablecategory="rate" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="degC/day" uri="-"/>
		<Input name="pSoilLayerDepth" description="Depths to the bottom of each (possibly extended) soil layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="0.0" default="-" unit="m" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="SoilTempArray" description="Updated soil temperature per layer after the daily step" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="degC" uri="-"/>
		<Output name="rSoilTempArrayRate" description="Updated daily temperature change per layer after the daily step" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="degC/day" uri="-"/>
		<Output name="pSoilLayerDepth" description="Updated depths to the bottom of each (possibly extended) soil layer after the daily step" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="0.0" unit="m" uri="-"/>
	</Outputs>
	<Initialization name="initialize_STMPsimCalculator" language="cyml" filename="algo/pyx/initialize_STMPsimCalculator.pyx"/>
	<Function name="-" description="-" language="cyml" type="external" filename="algo/pyx/-.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/model_STMPsimCalculator.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STMPsimCalculator_case0" description="Initializes the model and performs one process step, then checks expected SoilTempArray.">
			<Param name="cSoilLayerDepth">[0.1, 0.5, 1.5]</Param>
			<Param name="cFirstDayMeanTemp">15.0</Param>
			<Param name="cAVT">9.0</Param>
			<Param name="cABD">1.4</Param>
			<Param name="cDampingDepth">6.0</Param>
			<Param name="iDoInitialize">False</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STMPsimCalculator_case0" description="Initializes the model and performs one process step, then checks expected SoilTempArray." parameterset="p_test_STMPsimCalculator_case0">
			<Test name="t_test_STMPsimCalculator_case0">
				<InputValue name="iSoilWaterContent">0.3</InputValue>
				<InputValue name="iSoilSurfaceTemperature">6.0</InputValue>
				<OutputValue name="SoilTempArray">[13.624360856350041, 13.399968504634286, 12.599999999999845, 12.2, 11.4, 10.6, 9.799999999999999, 9.0]</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
