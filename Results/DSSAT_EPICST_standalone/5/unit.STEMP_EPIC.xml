<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP_EPIC" name="STEMP_EPIC" timestep="1" version="1.0">
	<Description>
		<Title>STEMP_EPIC</Title>
		<Authors>Kenneth N. Potter; Jimmy R. Williams</Authors>
		<Institution>USDA Agricultural Research Service (USDA-ARS)</Institution>
		<URI>-</URI>
		<Reference>https://doi.org/10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Implements the EPIC soil temperature method to compute daily soil surface and layer temperatures. The component uses soil properties, water content, surface cover (biomass, mulch, snow), and daily weather to update a five-day moving average driver and applies depth-dependent damping to estimate temperatures by layer.</ExtendedDescription>
		<ShortDescription>Determines daily soil temperature by layer using the EPIC method.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="ISWWAT" description="'Y' if water simulation enabled, else 'N'" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="1" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_BD" description="Bulk density by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="SOILPROP_DLAYR" description="Layer thickness" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DS" description="Cumulative depth to bottom of each layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="SOILPROP_DUL" description="Water content at drained upper limit by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="SOILPROP_LL" description="Lower limit water content by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="TAV" description="Average annual soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="SW" description="Volumetric water content by layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLELIST" len="NLAYR" max="-" min="0.0" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="TAVG" description="Average daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMAX" description="Maximum daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMIN" description="Minimum daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="WEATHER_RAIN" description="Daily rainfall" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0.0" default="-" unit="mm" uri="-"/>
		<Input name="MGMT_DEPIR" description="Irrigation depth" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0.0" default="-" unit="mm" uri="-"/>
		<Input name="PLANT_BIOMAS" description="Aboveground biomass" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0.0" default="-" unit="kg/ha" uri="-"/>
		<Input name="ORGC_MULCHMASS" description="Mulch mass on soil surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0.0" default="-" unit="kg/ha" uri="-"/>
		<Input name="WATER_SNOW" description="Snow cover" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0.0" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Total water content of soil at drained upper limit (running total)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="0.0" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="Memory of previous 5 days' surface temperature estimator" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="NDays" description="Number of days stored in WetDay memory" inputtype="variable" variablecategory="state" datatype="INT" max="30" min="0" default="-" unit="-" uri="-"/>
		<Input name="WetDay" description="30-day rolling window of wet-day indicators (0/1)" inputtype="variable" variablecategory="state" datatype="INTARRAY" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="X2_PREV" description="Previous day's average surface temperature estimator" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="CUMDPT" description="Cumulative soil profile depth" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0.0" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to midpoint of each soil layer" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="B" description="Thermal parameter ln(500/DP)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="DP" description="Damping depth for temperature waves" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0.0" default="-" unit="mm" uri="-"/>
		<Input name="WW" description="Volumetric water fraction function (0.356 - 0.144*ABD)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="PESW" description="Potential extractable soil water over profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0.0" default="-" unit="cm" uri="-"/>
		<Input name="BCV" description="Soil cover function from biomass/mulch/snow" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1.0" min="0.0" default="-" unit="-" uri="-"/>
		<Input name="WFT" description="Fraction of wet days in recent window" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1.0" min="0.0" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="TDL" description="Total water content of soil at drained upper limit (running total)" variablecategory="state" datatype="DOUBLE" max="-" min="0.0" unit="cm" uri="-"/>
		<Output name="TMA" description="Memory of previous 5 days' surface temperature estimator" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" unit="degC" uri="-"/>
		<Output name="NDays" description="Number of days stored in WetDay memory" variablecategory="state" datatype="INT" max="30" min="0" unit="-" uri="-"/>
		<Output name="WetDay" description="30-day rolling window of wet-day indicators (0/1)" variablecategory="state" datatype="INTARRAY" max="1" min="0" unit="-" uri="-"/>
		<Output name="X2_PREV" description="Previous day's average surface temperature estimator" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ST" description="Soil temperature by layer" variablecategory="state" datatype="DOUBLELIST" len="NLAYR" max="-" min="-" unit="degC" uri="-"/>
	</Outputs>
	<Initialization name="initialize_STEMP_EPIC" language="cyml" filename="algo/pyx/initialize_STEMP_EPIC.pyx"/>
	<Function name="SOILT_EPIC" description="EPIC soil temperature by layer; computes surface temperature and updates TMA, ST, and X2_PREV using thermal damping and cover effects." language="cyml" type="external" filename="algo/pyx/SOILT_EPIC.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP_EPIC.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STEMP_EPIC_initialize_example" description="Initialization scenario; returns outputs for inspection.">
			<Param name="ISWWAT">Y</Param>
			<Param name="NLAYR">4</Param>
			<Param name="SOILPROP_BD">[1.6, 1.6, 1.6, 1.6]</Param>
			<Param name="SOILPROP_DLAYR">[10.0, 10.0, 10.0, 10.0]</Param>
			<Param name="SOILPROP_DS">[10.0, 20.0, 30.0, 40.0]</Param>
			<Param name="SOILPROP_DUL">[0.3, 0.3, 0.3, 0.3]</Param>
			<Param name="SOILPROP_LL">[0.2, 0.2, 0.2, 0.2]</Param>
			<Param name="TAV">20.0</Param>
		</Parameterset>
		<Parameterset name="p_test_STEMP_EPIC_daily_example" description="One-day update scenario; uses init outputs, returns daily outputs for inspection.">
			<Param name="ISWWAT">Y</Param>
			<Param name="NLAYR">4</Param>
			<Param name="SOILPROP_BD">[1.6, 1.6, 1.6, 1.6]</Param>
			<Param name="SOILPROP_DLAYR">[10.0, 10.0, 10.0, 10.0]</Param>
			<Param name="SOILPROP_DS">[10.0, 20.0, 30.0, 40.0]</Param>
			<Param name="SOILPROP_DUL">[0.3, 0.3, 0.3, 0.3]</Param>
			<Param name="SOILPROP_LL">[0.2, 0.2, 0.2, 0.2]</Param>
			<Param name="TAV">20.0</Param>
			<Param name="ISWWAT">Y</Param>
			<Param name="NLAYR">4</Param>
			<Param name="SOILPROP_BD">[1.6, 1.6, 1.6, 1.6]</Param>
			<Param name="SOILPROP_DLAYR">[10.0, 10.0, 10.0, 10.0]</Param>
			<Param name="SOILPROP_DS">[10.0, 20.0, 30.0, 40.0]</Param>
			<Param name="SOILPROP_DUL">[0.3, 0.3, 0.3, 0.3]</Param>
			<Param name="SOILPROP_LL">[0.2, 0.2, 0.2, 0.2]</Param>
			<Param name="TAV">20.0</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STEMP_EPIC_initialize_example" description="Initialization scenario; returns outputs for inspection." parameterset="p_test_STEMP_EPIC_initialize_example">
			<Test name="t_test_STEMP_EPIC_initialize_example">
				<InputValue name="SW">[0.2, 0.2, 0.2, 0.2]</InputValue>
				<InputValue name="TAVG">25.0</InputValue>
				<InputValue name="TMAX">30.0</InputValue>
				<InputValue name="TMIN">20.0</InputValue>
				<InputValue name="ORGC_MULCHMASS">0.0</InputValue>
				<InputValue name="WATER_SNOW">0.0</InputValue>
			</Test>
		</Testset>
		<Testset name="t_test_STEMP_EPIC_daily_example" description="One-day update scenario; uses init outputs, returns daily outputs for inspection." parameterset="p_test_STEMP_EPIC_daily_example">
			<Test name="t_test_STEMP_EPIC_daily_example">
				<InputValue name="SW">[0.2, 0.2, 0.2, 0.2]</InputValue>
				<InputValue name="TAVG">25.0</InputValue>
				<InputValue name="TMAX">30.0</InputValue>
				<InputValue name="TMIN">20.0</InputValue>
				<InputValue name="ORGC_MULCHMASS">0.0</InputValue>
				<InputValue name="WATER_SNOW">0.0</InputValue>
				<InputValue name="SW">[0.2, 0.2, 0.2, 0.2]</InputValue>
				<InputValue name="TAVG">25.0</InputValue>
				<InputValue name="TMAX">30.0</InputValue>
				<InputValue name="TMIN">20.0</InputValue>
				<InputValue name="WEATHER_RAIN">0.0</InputValue>
				<InputValue name="MGMT_DEPIR">0.0</InputValue>
				<InputValue name="PLANT_BIOMAS">0.0</InputValue>
				<InputValue name="ORGC_MULCHMASS">0.0</InputValue>
				<InputValue name="WATER_SNOW">0.0</InputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
