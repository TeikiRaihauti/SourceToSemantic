<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP_EPIC" name="STEMP_EPIC" timestep="1" version="1.0">
	<Description>
		<Title>STEMP_EPIC</Title>
		<Authors>Kenneth N. Potter; Jimmy R. Williams</Authors>
		<Institution>USDA-ARS</Institution>
		<URI>-</URI>
		<Reference>10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Implements the EPIC soil temperature routine to compute daily soil temperatures by soil layer. The component uses bulk density, layer thickness, cumulative depth, soil water (or drained upper limit), residue/mulch and snow cover, and a 30-day wet-day fraction to adjust temperature damping and surface temperature. It maintains a 5-day moving average driver (X2), applies cover effects, and updates surface and layer temperatures with a lag factor. Outputs include surface temperature and per-layer soil temperature.</ExtendedDescription>
		<ShortDescription>Determines soil temperature by layer</ShortDescription>
	</Description>
	<Inputs>
		<Input name="iswitch_ISWWAT" description="Water balance switch ('Y' or 'N')" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="soilprop_BD" description="Bulk density per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="soilprop_DLAYR" description="Layer thickness" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="soilprop_DS" description="Cumulative depth by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="soilprop_DUL" description="Drained upper limit per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="soilprop_LL" description="Lower limit per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="soilprop_NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SW" description="Soil water content by layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="cm3/cm3" uri="-"/>
		<Input name="TAVG" description="Average daily temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMAX" description="Maximum daily temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMIN" description="Minimum daily temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TAV" description="Average annual air/soil temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="orgc_MULCHMASS" description="Surface mulch mass" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="kg/ha" uri="-"/>
		<Input name="water_SNOW" description="Snow cover" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="X2_PREV" description="Previous surface temperature memory" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="weather_RAIN" description="Daily rainfall" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="mgmt_DEPIR" description="Daily irrigation depth" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="plant_BIOMAS" description="Above-ground biomass" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="kg/ha" uri="-"/>
		<Input name="CUMDPT" description="Cumulative profile depth" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to midpoint of each layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Total water content at DUL integrated across layers" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="Previous 5-day X2 memory" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="NDays" description="Number of days tracked for wet day memory" inputtype="variable" variablecategory="state" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="WetDay" description="Last 30 days 0/1 wet day flags" inputtype="variable" variablecategory="state" datatype="INTARRAY" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SRFTEMP" description="Soil surface temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="B" description="Exponential decay factor (ln(500/DP))" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="BCV" description="Soil cover function" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="fraction" uri="-"/>
		<Input name="DP" description="Damping depth" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="NLAYR" description="Number of soil layers (alias passed to supporting function)" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="PESW" description="Potential extractable soil water over profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="WFT" description="Fraction wet days over last 30 days" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="WW" description="Soil water content at saturation (function of BD)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="fraction" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="TDL" description="Total water content at DUL integrated across layers after update" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="cm" uri="-"/>
		<Output name="TMA" description="Updated previous 5-day X2 memory" variablecategory="state" datatype="DOUBLELIST" len="5" max="-" min="-" unit="degC" uri="-"/>
		<Output name="NDays" description="Updated number of days tracked for wet day memory" variablecategory="state" datatype="INT" max="-" min="-" unit="-" uri="-"/>
		<Output name="WetDay" description="Updated last 30 days 0/1 wet day flags" variablecategory="state" datatype="INTARRAY" max="-" min="-" unit="-" uri="-"/>
		<Output name="X2_PREV" description="Updated previous surface temperature memory" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="SRFTEMP" description="Updated soil surface temperature" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ST" description="Updated soil temperature by layer" variablecategory="state" datatype="DOUBLELIST" len="-" max="-" min="-" unit="degC" uri="-"/>
	</Outputs>
	<Initialization name="STEMP_EPIC_Initialize" language="cyml" filename="algo/pyx/STEMP_EPIC_Initialize.pyx"/>
	<Function name="STEMP_EPIC_Initialize" description="Seasonal initialization for EPIC soil temperature routine." language="cyml" type="external" filename="algo/pyx/STEMP_EPIC_Initialize.pyx"/>
	<Function name="STEMP_EPIC" description="Daily main biophysical process for EPIC soil temperature routine." language="cyml" type="external" filename="algo/pyx/STEMP_EPIC.pyx"/>
	<Function name="SOILT_EPIC" description="EPIC soil temperature calculation by layer." language="cyml" type="external" filename="algo/pyx/SOILT_EPIC.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP_EPIC.pyx"/>
	<Parametersets/>
	<Testsets/>
</ModelUnit>
