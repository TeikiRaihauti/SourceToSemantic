<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP_EPIC" name="STEMP_EPIC" timestep="1" version="1.0">
	<Description>
		<Title>STEMP_EPIC</Title>
		<Authors>Kenneth N. Potter; Jimmy R. Williams</Authors>
		<Institution>USDA Agricultural Research Service (USDA-ARS)</Institution>
		<URI>-</URI>
		<Reference>https://doi.org/10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Computes daily soil temperature profiles by layer using the EPIC methodology (Potter &amp; Williams, 1994). It updates surface and layer temperatures from soil properties, water content, fraction of wet days, surface cover (biomass, mulch, snow), and weather (air temperatures and annual mean), with a short-term temperature memory.</ExtendedDescription>
		<ShortDescription>Determines soil temperature by layer.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="ISWWAT" description="'Y' if water simulation is on, otherwise 'N'" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="BD" description="Bulk density per soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="g/cm3" uri="-"/>
		<Input name="DLAYR" description="Layer thickness" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="DS" description="Cumulative depth at bottom of each layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="DUL" description="Drained upper limit (vol/vol) per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="vol/vol" uri="-"/>
		<Input name="LL" description="Lower limit (vol/vol) per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="vol/vol" uri="-"/>
		<Input name="NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SW" description="Soil water content (vol/vol) per layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="vol/vol" uri="-"/>
		<Input name="TAVG" description="Average daily air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMAX" description="Daily maximum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TMIN" description="Daily minimum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="TAV" description="Average annual soil temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="WEATHER_RAIN" description="Daily rainfall" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="MGMT_DEPIR" description="Daily irrigation depth" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="PLANT_BIOMAS" description="Plant aboveground biomass" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="kg/ha" uri="-"/>
		<Input name="ORGC_MULCHMASS" description="Organic mulch mass on soil surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="kg/ha" uri="-"/>
		<Input name="WATER_SNOW" description="Snow water equivalent on soil surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="CUMDPT" description="Cumulative soil profile depth" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="DSMID" description="Depth to midpoint of each layer" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="TDL" description="Total water content at DUL over profile" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="cm" uri="-"/>
		<Input name="TMA" description="5-day memory array for surface temperature driver" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="NDays" description="Number of days stored in wet-day memory (&lt;=30)" inputtype="variable" variablecategory="state" datatype="INT" max="30" min="0" default="-" unit="-" uri="-"/>
		<Input name="WetDay" description="Wet-day memory flags over last 30 days (0/1)" inputtype="variable" variablecategory="state" datatype="INTARRAY" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="X2_PREV" description="Previous day's smoothed surface temperature memory" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="SRFTEMP" description="Previous surface temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" default="-" unit="degC" uri="-"/>
		<Input name="B" description="Exponential decay factor for damping depth computation" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="BCV" description="Soil cover fraction combining biomass, mulch, and snow" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="DP" description="Soil temperature damping depth" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="mm" uri="-"/>
		<Input name="PESW" description="Potential extractable soil water over profile" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="cm" uri="-"/>
		<Input name="WFT" description="Fraction of wet days in memory window" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="WW" description="Volumetric water content parameter used in damping depth calculation" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="WetDay" description="Wet-day flag passed to layer temperature routine (0 dry, 1 wet)" inputtype="variable" variablecategory="auxiliary" datatype="INT" max="1" min="0" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="TDL" description="Updated total water content at DUL over profile" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="cm" uri="-"/>
		<Output name="TMA" description="Updated 5-day memory array for surface temperature driver" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" unit="degC" uri="-"/>
		<Output name="NDays" description="Updated number of days stored in wet-day memory" variablecategory="state" datatype="INT" max="30" min="0" unit="-" uri="-"/>
		<Output name="WetDay" description="Updated wet-day memory flags over last 30 days" variablecategory="state" datatype="INTARRAY" max="1" min="0" unit="-" uri="-"/>
		<Output name="X2_PREV" description="Updated smoothed surface temperature memory" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="SRFTEMP" description="Updated surface temperature" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="degC" uri="-"/>
		<Output name="ST" description="Updated soil temperature by layer" variablecategory="state" datatype="DOUBLEARRAY" len="NLAYR" max="-" min="-" unit="degC" uri="-"/>
	</Outputs>
	<Initialization name="STEMP_EPIC_initialize" language="cyml" filename="algo/pyx/STEMP_EPIC_initialize.pyx"/>
	<Function name="SOILT_EPIC" description="Computes surface and layer soil temperatures using EPIC method with wet-day classification, cover effects, and damping depth." language="cyml" type="external" filename="algo/pyx/SOILT_EPIC.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP_EPIC.pyx"/>
	<Parametersets>
		<Parameterset name="p_test_STEMP_EPIC_example" description="Initialization and multi-day run derived from ASKEE_DSSAT_EPIC.for to ensure outputs are reasonable and array sizes/types hold.">
			<Param name="ISWWAT">Y</Param>
			<Param name="NLAYR">4</Param>
			<Param name="BD">[1.6, 1.6, 1.6, 1.6]</Param>
			<Param name="DLAYR">[10.0, 10.0, 10.0, 10.0]</Param>
			<Param name="DS">[10.0, 20.0, 30.0, 40.0]</Param>
			<Param name="DUL">[0.3, 0.3, 0.3, 0.3]</Param>
			<Param name="LL">[0.2, 0.2, 0.2, 0.2]</Param>
		</Parameterset>
	</Parametersets>
	<Testsets>
		<Testset name="t_test_STEMP_EPIC_example" description="Initialization and multi-day run derived from ASKEE_DSSAT_EPIC.for to ensure outputs are reasonable and array sizes/types hold." parameterset="p_test_STEMP_EPIC_example">
			<Test name="t_test_STEMP_EPIC_example">
				<InputValue name="SW">[0.2, 0.2, 0.2, 0.2]</InputValue>
				<InputValue name="TAVG">25.0</InputValue>
				<InputValue name="TMAX">30.0</InputValue>
				<InputValue name="TMIN">20.0</InputValue>
				<InputValue name="TAV">20.0</InputValue>
				<InputValue name="WEATHER_RAIN">0.0</InputValue>
				<InputValue name="ORGC_MULCHMASS">0.0</InputValue>
				<InputValue name="WATER_SNOW">0.0</InputValue>
				<InputValue name="MGMT_DEPIR">0.0</InputValue>
				<InputValue name="PLANT_BIOMAS">0.0</InputValue>
				<InputValue name="X2_PREV">0.0</InputValue>
				<OutputValue name="DSMID length">4</OutputValue>
				<OutputValue name="ST length">4</OutputValue>
				<OutputValue name="TMA length">5</OutputValue>
				<OutputValue name="WetDay length">30</OutputValue>
				<OutputValue name="NDays range">1..30</OutputValue>
				<OutputValue name="SRFTEMP type">float</OutputValue>
				<OutputValue name="WetDay element type">int</OutputValue>
			</Test>
		</Testset>
	</Testsets>
</ModelUnit>
