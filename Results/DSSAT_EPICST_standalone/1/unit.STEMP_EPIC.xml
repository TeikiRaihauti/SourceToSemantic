<?xml version="1.0" ?>
<ModelUnit modelid=".STEMP_EPIC" name="STEMP_EPIC" timestep="1" version="1.0">
	<Description>
		<Title>STEMP_EPIC</Title>
		<Authors>Kenneth N. Potter; Jimmy R. Williams</Authors>
		<Institution>USDA Agricultural Research Service (USDA-ARS)</Institution>
		<URI>-</URI>
		<Reference>10.2134/agronj1994.00021962008600060014x</Reference>
		<ExtendedDescription>Determines daily soil temperature by layer using the EPIC method (Potter &amp; Williams, 1994). It computes surface temperature from air temperatures, a 30‑day wet‑day fraction, and surface cover (biomass, mulch, snow), then propagates temperature into soil layers using a bulk‑density dependent damping depth and potential extractable soil water. Outputs include surface temperature (SRFTEMP) and layer temperatures (ST).</ExtendedDescription>
		<ShortDescription>Daily soil temperature by layer using the EPIC method.</ShortDescription>
	</Description>
	<Inputs>
		<Input name="CONTROL_DYNAMIC" description="Phase control flag (e.g., 2=seasonal init, 3=daily step)" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="ISWITCH_ISWWAT" description="Water balance switch (Y/N) affecting PESW computation" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="-" min="-" default="Y" unit="-" uri="-"/>
		<Input name="SOILPROP_BD" description="Bulk density by soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_DLAYR" description="Layer thickness by soil layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_DS" description="Cumulative soil depth by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_DUL" description="Drained upper limit by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_LL" description="Lower limit by layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="SOILPROP_NLAYR" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="-" min="1" default="-" unit="-" uri="-"/>
		<Input name="SW" description="Soil water content by layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="TAVG" description="Daily average air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TMAX" description="Daily maximum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TMIN" description="Daily minimum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="TAV" description="Long-term average air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="WEATHER_RAIN" description="Daily rainfall" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="CUMDPT" description="Cumulative soil depth used in temperature damping" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="DSMID" description="Midpoint depth of each soil layer" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="TDL" description="Total drained upper limit across layers" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="TMA" description="5-day running series used for surface temperature smoothing" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="NDays" description="Count of days tracked in the wet-day window (max 30)" inputtype="variable" variablecategory="state" datatype="INT" max="30" min="0" default="-" unit="d" uri="-"/>
		<Input name="WetDay" description="Rolling 30-day wet/dry flags (1=wet,0=dry)" inputtype="variable" variablecategory="state" datatype="INTARRAY" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="X2_PREV" description="Previous 5-day smoothed surface driver (X2 average)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="SRFTEMP" description="Surface temperature (returned; passed through if no update)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="ST" description="Soil temperature by layer" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" default="-" unit="C" uri="-"/>
		<Input name="ORGC_MULCHMASS" description="Organic mulch mass on soil surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="WATER_SNOW" description="Snow water equivalent on surface" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="MGMT_DEPIR" description="Daily irrigation application" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="PLANT_BIOMAS" description="Aboveground plant biomass" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="B" description="Damping coefficient for soil temperature profile (log(500/DP))" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
		<Input name="BCV" description="Soil cover factor from biomass/mulch/snow" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="DP" description="Damping depth parameter for soil temperature" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="PESW" description="Plant-extractable soil water (profile total)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="0" default="-" unit="-" uri="-"/>
		<Input name="WFT" description="Wet-day frequency over the tracked window" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="1" min="0" default="-" unit="-" uri="-"/>
		<Input name="WW" description="Soil water parameter used in temperature damping" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLE" max="-" min="-" default="-" unit="-" uri="-"/>
	</Inputs>
	<Outputs>
		<Output name="CUMDPT" description="Updated cumulative soil depth used in damping" variablecategory="state" datatype="DOUBLE" max="-" min="0" unit="-" uri="-"/>
		<Output name="DSMID" description="Updated layer midpoint depths" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="0" unit="-" uri="-"/>
		<Output name="TDL" description="Updated total drained upper limit" variablecategory="state" datatype="DOUBLE" max="-" min="0" unit="-" uri="-"/>
		<Output name="TMA" description="Updated 5-day surface driver series" variablecategory="state" datatype="DOUBLEARRAY" len="5" max="-" min="-" unit="C" uri="-"/>
		<Output name="NDays" description="Updated count of days in wet-day window" variablecategory="state" datatype="INT" max="30" min="0" unit="d" uri="-"/>
		<Output name="WetDay" description="Updated rolling 30-day wet/dry flags" variablecategory="state" datatype="INTARRAY" max="1" min="0" unit="-" uri="-"/>
		<Output name="X2_PREV" description="Updated previous X2 average (for next step smoothing)" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="C" uri="-"/>
		<Output name="SRFTEMP" description="Computed surface temperature for the day" variablecategory="state" datatype="DOUBLE" max="-" min="-" unit="C" uri="-"/>
		<Output name="ST" description="Updated soil temperature profile by layer" variablecategory="state" datatype="DOUBLEARRAY" len="SOILPROP_NLAYR" max="-" min="-" unit="C" uri="-"/>
	</Outputs>
	<Initialization name="STEMP_EPIC" language="cyml" filename="algo/pyx/STEMP_EPIC.pyx"/>
	<Function name="SOILT_EPIC" description="Core soil temperature update using EPIC approach; computes surface temperature, updates 5-day series and soil layer temperatures." language="cyml" type="external" filename="algo/pyx/SOILT_EPIC.pyx"/>
	<Function name="_nint" description="Round to nearest integer (Fortran-style)." language="cyml" type="external" filename="algo/pyx/_nint.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/STEMP_EPIC.pyx"/>
	<Parametersets/>
	<Testsets/>
</ModelUnit>
