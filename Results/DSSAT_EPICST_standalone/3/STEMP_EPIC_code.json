{
    "init": {
        "name": "STEMP_EPIC"
    },
    "process": {
        "name": "STEMP_EPIC",
        "description": "Determines soil temperature by layer using the EPIC method. Combines seasonal initialization (SEASINIT) and daily rate (RATE) branches controlled by DYNAMIC."
    },
    "inputs": [
        {
            "name": "DYNAMIC",
            "description": "Controls operation mode: 'SEASINIT' for seasonal initialization or 'RATE' for daily update",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "ISWWAT",
            "description": "Water balance switch: 'Y' use actual soil water, 'N' use DUL for potential extractable soil water",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "BD",
            "description": "Soil bulk density by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": "-"
        },
        {
            "name": "DLAYR",
            "description": "Soil layer thicknesses",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": "-"
        },
        {
            "name": "DS",
            "description": "Cumulative soil depth at bottom of each layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": "-"
        },
        {
            "name": "DUL",
            "description": "Drained upper limit (field capacity) by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm3/cm3",
            "uri": "-"
        },
        {
            "name": "LL",
            "description": "Lower limit by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm3/cm3",
            "uri": "-"
        },
        {
            "name": "NLAYR",
            "description": "Number of soil layers",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "INT",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "SW",
            "description": "Volumetric soil water content by layer",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm3/cm3",
            "uri": "-"
        },
        {
            "name": "TAVG",
            "description": "Daily average air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "TMAX",
            "description": "Daily maximum air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "TMIN",
            "description": "Daily minimum air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "TAV",
            "description": "Long-term average air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "RAIN",
            "description": "Daily precipitation",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "DEPIR",
            "description": "Daily irrigation depth",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "BIOMAS",
            "description": "Plant biomass",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "kg/ha",
            "uri": "-"
        },
        {
            "name": "MULCHMASS",
            "description": "Mulch mass on soil surface",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "kg/ha",
            "uri": "-"
        },
        {
            "name": "SNOW",
            "description": "Snow water equivalent on soil surface",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "CUMDPT",
            "description": "Cumulative soil profile depth",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "DSMID",
            "description": "Depth to midpoint of each soil layer",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "TDL",
            "description": "Total water at DUL (accumulated)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": "-"
        },
        {
            "name": "TMA",
            "description": "Prior 5 days of surface temperature driver X2",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLELIST",
            "len": "5",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "NDays",
            "description": "Number of days tracked in 30-day wet-day memory",
            "inputtype": "variable",
            "category": "state",
            "datatype": "INT",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "WetDay",
            "description": "30-day wet-day history (0/1 per day)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "INTARRAY",
            "len": "30",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "X2_PREV",
            "description": "Previous day's X2 average used for smoothing",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "SRFTEMP",
            "description": "Surface temperature",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "ST",
            "description": "Soil temperature by layer",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLELIST",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        }
    ],
    "outputs": [
        {
            "name": "CUMDPT",
            "description": "Updated cumulative soil profile depth",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "DSMID",
            "description": "Updated depth to midpoint of each soil layer",
            "datatype": "DOUBLELIST",
            "category": "state",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "TDL",
            "description": "Updated total water at DUL (accumulated)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "cm",
            "uri": "-"
        },
        {
            "name": "TMA",
            "description": "Updated 5-day history of surface temperature driver X2",
            "datatype": "DOUBLELIST",
            "category": "state",
            "len": "5",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "NDays",
            "description": "Updated number of days in wet-day memory",
            "datatype": "INT",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "WetDay",
            "description": "Updated 30-day wet-day history",
            "datatype": "INTARRAY",
            "category": "state",
            "len": "30",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "X2_PREV",
            "description": "Updated previous day's X2 average",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "SRFTEMP",
            "description": "Updated surface temperature",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "ST",
            "description": "Updated soil temperature by layer",
            "datatype": "DOUBLELIST",
            "category": "state",
            "len": "NLAYR",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        }
    ],
    "functions": [
        {
            "name": "STEMP_EPIC",
            "description": "Main component function combining seasonal initialization (SEASINIT) and daily rate (RATE) to compute soil temperatures by layer."
        },
        {
            "name": "SOILT_EPIC",
            "description": "EPIC soil temperature routine updating TMA, surface temperature, and layer soil temperatures given drivers and soil properties."
        },
        {
            "name": "fortran_nint",
            "description": "Helper rounding function emulating Fortran NINT, used to initialize TMA."
        }
    ],
    "tests": [
        {
            "name": "test_STEMP_EPIC_from_ASKEE",
            "description": "Runs STEMP_EPIC for SEASINIT then RATE with fixed inputs; asserts types and array lengths.",
            "inputs": [
                {
                    "name": "ISWWAT",
                    "value": "Y"
                },
                {
                    "name": "NLAYR",
                    "value": 4
                },
                {
                    "name": "BD",
                    "value": [
                        1.6,
                        1.6,
                        1.6,
                        1.6
                    ]
                },
                {
                    "name": "DLAYR",
                    "value": [
                        10.0,
                        10.0,
                        10.0,
                        10.0
                    ]
                },
                {
                    "name": "DS",
                    "value": [
                        10.0,
                        20.0,
                        30.0,
                        40.0
                    ]
                },
                {
                    "name": "DUL",
                    "value": [
                        0.3,
                        0.3,
                        0.3,
                        0.3
                    ]
                },
                {
                    "name": "LL",
                    "value": [
                        0.2,
                        0.2,
                        0.2,
                        0.2
                    ]
                },
                {
                    "name": "SW",
                    "value": [
                        0.2,
                        0.2,
                        0.2,
                        0.2
                    ]
                },
                {
                    "name": "TAVG",
                    "value": 25.0
                },
                {
                    "name": "TMAX",
                    "value": 30.0
                },
                {
                    "name": "TMIN",
                    "value": 20.0
                },
                {
                    "name": "TAV",
                    "value": 20.0
                },
                {
                    "name": "RAIN",
                    "value": 0.0
                },
                {
                    "name": "DEPIR",
                    "value": 0.0
                },
                {
                    "name": "BIOMAS",
                    "value": 0.0
                },
                {
                    "name": "MULCHMASS",
                    "value": 0.0
                },
                {
                    "name": "SNOW",
                    "value": 0.0
                },
                {
                    "name": "CUMDPT_init",
                    "value": 0.0
                },
                {
                    "name": "DSMID_init",
                    "value": [
                        0.0,
                        0.0,
                        0.0,
                        0.0
                    ]
                },
                {
                    "name": "TDL_init",
                    "value": 0.0
                },
                {
                    "name": "TMA_init",
                    "value": [
                        0.0,
                        0.0,
                        0.0,
                        0.0,
                        0.0
                    ]
                },
                {
                    "name": "NDays_init",
                    "value": 0
                },
                {
                    "name": "WetDay_init",
                    "value": [
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        0
                    ]
                },
                {
                    "name": "X2_PREV_init",
                    "value": 0.0
                },
                {
                    "name": "SRFTEMP_init",
                    "value": 0.0
                },
                {
                    "name": "ST_init",
                    "value": [
                        0.0,
                        0.0,
                        0.0,
                        0.0
                    ]
                }
            ],
            "outputs": [
                {
                    "name": "CUMDPT_type",
                    "value": "float"
                },
                {
                    "name": "TDL_type",
                    "value": "float"
                },
                {
                    "name": "SRFTEMP_type",
                    "value": "float"
                },
                {
                    "name": "NDays_type",
                    "value": "int"
                },
                {
                    "name": "len_DSMID",
                    "value": 4
                },
                {
                    "name": "len_ST",
                    "value": 4
                },
                {
                    "name": "len_TMA",
                    "value": 5
                },
                {
                    "name": "len_WetDay",
                    "value": 30
                }
            ]
        }
    ]
}