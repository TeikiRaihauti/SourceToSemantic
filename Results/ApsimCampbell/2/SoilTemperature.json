{
    "metadata": {
        "Title": "SoilTemperature",
        "Authors": "-",
        "Institution": "-",
        "URI": "-",
        "DOI": "-",
        "Extended description": "Simulates soil temperature dynamics over a soil profile using sub-daily time steps. Includes heat storage and transfer between nodes (air, surface, and soil layers), boundary layer conductance with stability corrections, shortwave/longwave radiative balance, and a tridiagonal solver (Thomas algorithm) for the heat equation. Profile representation follows Campbell (1985).",
        "Short description": "Sub-daily soil temperature model with atmospheric coupling and heat conduction through a multi-node soil profile.",
        "Model version": "-"
    },
    "init": {
        "name": "OnStartOfSimulation"
    },
    "process": {
        "name": "OnProcess",
        "description": "Daily soil temperature update (event DoSoilTemperature). Initializes state if required, ingests external drivers, performs sub-daily iterations to solve heat flow using boundary layer conductance and Thomas algorithm, and updates min/avg/max soil temperatures."
    },
    "inputs": [
        {
            "name": "InitialValues",
            "description": "Initial soil temperature for each layer (top to bottom) used at first call.",
            "inputtype": "-",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "DepthToConstantTemperature",
            "description": "Depth to constant temperature used to size phantom nodes below the profile.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "10000",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "weather_MeanT",
            "description": "Mean daily air temperature.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_MaxT",
            "description": "Maximum daily air temperature.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_MinT",
            "description": "Minimum daily air temperature.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_Tav",
            "description": "Long-term average air temperature used for initialisation and deep nodes.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_Amp",
            "description": "Annual air temperature amplitude for seasonal initial profile.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_Radn",
            "description": "Daily global solar radiation used for net radiation partitioning.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "MJ/m2/d",
            "uri": "-"
        },
        {
            "name": "weather_Latitude",
            "description": "Site latitude used in solar geometry and seasonal phase of initial profile.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "degrees",
            "uri": "-"
        },
        {
            "name": "weather_AirPressure",
            "description": "Air pressure used for air density in boundary layer conductance.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "hPa",
            "uri": "-"
        },
        {
            "name": "weather_Wind",
            "description": "Wind speed at instrument height for boundary layer conductance.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "m/s",
            "uri": "-"
        },
        {
            "name": "clock_Today_DayOfYear",
            "description": "Current day-of-year for solar geometry and seasonal temperature profile.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "-",
            "unit": "day",
            "uri": "-"
        },
        {
            "name": "microClimate_CanopyHeight",
            "description": "Canopy height used to set roughness and displacement in boundary layer conductance.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "physical_Thickness",
            "description": "Soil layer thicknesses used to construct node depths and phantom layers.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "physical_BD",
            "description": "Soil bulk density per layer for thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": "-"
        },
        {
            "name": "physical_Rocks",
            "description": "Rock fraction per layer used in volumetric composition and thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeSand",
            "description": "Sand fraction per layer used in volumetric composition and thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeSilt",
            "description": "Silt fraction per layer used in volumetric composition and thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeClay",
            "description": "Clay fraction per layer used in volumetric composition and thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "organic_Carbon",
            "description": "Carbon content per layer used in organic matter fraction for thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "waterBalance_SW",
            "description": "Volumetric soil water content per layer used for thermal properties.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "mm3/mm3",
            "uri": "-"
        },
        {
            "name": "waterBalance_Eos",
            "description": "Potential soil evaporation used for estimating net radiation and cover penetration.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm/d",
            "uri": "-"
        },
        {
            "name": "waterBalance_Eo",
            "description": "Reference evaporation used for cover effects in radiative conductance and net radiation.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm/d",
            "uri": "-"
        },
        {
            "name": "waterBalance_Es",
            "description": "Actual soil evaporation used for latent heat flux at the surface boundary.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm/d",
            "uri": "-"
        },
        {
            "name": "waterBalance_Salb",
            "description": "Soil albedo used to partition incoming shortwave radiation.",
            "inputtype": "-",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "nu",
            "description": "Forward/backward differencing coefficient for the heat equation solver (0-1).",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "0.6",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "boundarLayerConductanceSource",
            "description": "Method for atmospheric boundary layer conductance ('calc' or 'constant').",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "calc",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "constantBoundaryLayerConductance",
            "description": "Constant boundary layer conductance used when source='constant'.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "20",
            "unit": "W/K",
            "uri": "-"
        },
        {
            "name": "numIterationsForBoundaryLayerConductance",
            "description": "Number of iterations to refine atmospheric boundary layer conductance per time step.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "INT",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "1",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "netRadiationSource",
            "description": "Method for net radiation at surface ('calc' from SW/LW or 'eos').",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "calc",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "defaultTimeOfMaximumTemperature",
            "description": "Time of day for daily maximum air temperature used by temperature interpolation.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "24",
            "default": "14",
            "unit": "h",
            "uri": "-"
        },
        {
            "name": "defaultInstrumentHeight",
            "description": "Default instrument height above ground used if no microclimate height dictates otherwise.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "1.2",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "bareSoilRoughness",
            "description": "Roughness element height for bare soil used in boundary layer calculations when no canopy.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "57",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "latentHeatOfVapourisation",
            "description": "Latent heat of vaporisation for water used to convert evaporation to energy flux.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "2465000",
            "unit": "J/kg",
            "uri": "-"
        },
        {
            "name": "stefanBoltzmannConstant",
            "description": "Stefan-Boltzmann constant used for longwave radiation calculations.",
            "inputtype": "-",
            "category": "parameter",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "5.67E-8",
            "unit": "W/m2/K4",
            "uri": "-"
        }
    ],
    "outputs": [
        {
            "name": "FinalSoilTemperature",
            "description": "Temperature of each soil layer at end of day (midnight).",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "FinalSoilSurfaceTemperature",
            "description": "Soil surface temperature at end of day (midnight).",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "AverageSoilTemperature",
            "description": "Average soil temperature per layer over the day.",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "AverageSoilSurfaceTemperature",
            "description": "Average soil surface temperature over the day.",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MinimumSoilTemperature",
            "description": "Minimum soil temperature per layer during the day.",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MinimumSoilSurfaceTemperature",
            "description": "Minimum soil surface temperature during the day.",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MaximumSoilTemperature",
            "description": "Maximum soil temperature per layer during the day.",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MaximumSoilSurfaceTemperature",
            "description": "Maximum soil surface temperature during the day.",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "BoundaryLayerConductance",
            "description": "Average daily atmospheric boundary layer conductance.",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W/K",
            "uri": "-"
        },
        {
            "name": "ThermalConductivity",
            "description": "Thermal conductivity profile (node-based) used in the heat equation.",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W.m/K",
            "uri": "-"
        },
        {
            "name": "HeatCapacity",
            "description": "Volumetric heat capacity profile (node-based).",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J/K/m3",
            "uri": "-"
        },
        {
            "name": "HeatStore",
            "description": "Heat storage (capacity per node over time step).",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J/K",
            "uri": "-"
        },
        {
            "name": "Thr_profile",
            "description": "Soil temperature profile captured in the early morning (internal diagnostic).",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        }
    ],
    "functions": [
        {
            "name": "getOtherVariables",
            "description": "Refresh exogenous inputs used at sub-daily steps (soil water, canopy height, instrument height)."
        },
        {
            "name": "calcSoilTemperature",
            "description": "Compute initial seasonal soil temperature profile based on Tav, Amp, latitude, and day-of-year."
        },
        {
            "name": "calcSurfaceTemperature",
            "description": "Estimate initial soil surface temperature from air temperature, radiation, and soil albedo."
        },
        {
            "name": "doProcess",
            "description": "Perform sub-daily iterations for a day: compute net radiation, volumetric heat capacity, thermal conductivity, boundary layer conductance, solve tridiagonal heat system, and update min/max/avg."
        }
    ],
    "tests": [
        {
            "name": "-",
            "description": "-",
            "inputs": [
                {
                    "name": "-",
                    "value": "-"
                }
            ],
            "outputs": [
                {
                    "name": "-",
                    "value": "-"
                }
            ]
        }
    ]
}