{
    "init": {
        "name": "initialize_SoilTemperature"
    },
    "process": {
        "name": "process_SoilTemperature",
        "description": "Updates the soil thermal state over a day using sub-daily energy balance and heat diffusion to compute soil temperature profiles."
    },
    "inputs": [
        {
            "name": "physical_Thickness",
            "description": "Soil layer thickness by layer (top to bottom)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "physical_BD",
            "description": "Bulk density by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "3",
            "default": "-",
            "unit": "g cm-3",
            "uri": "-"
        },
        {
            "name": "physical_Rocks",
            "description": "Rock fragment content by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeSand",
            "description": "Sand fraction by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeSilt",
            "description": "Silt fraction by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeClay",
            "description": "Clay fraction by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "organic_Carbon",
            "description": "Organic carbon content by layer",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "waterBalance_SW",
            "description": "Soil water content by layer",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "m3 m-3",
            "uri": "-"
        },
        {
            "name": "waterBalance_Salb",
            "description": "Soil surface albedo",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "microClimate_CanopyHeight",
            "description": "Canopy height",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "weather_Tav",
            "description": "Average temperature baseline used for deep soil temp initialization",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-60",
            "max": "60",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "weather_MeanT",
            "description": "Daily mean air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-60",
            "max": "60",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "weather_MaxT",
            "description": "Daily maximum air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-60",
            "max": "70",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "weather_MinT",
            "description": "Daily minimum air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90",
            "max": "50",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "weather_Amp",
            "description": "Annual temperature amplitude used for initial deep soil temperature wave",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "60",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "weather_Latitude",
            "description": "Site latitude",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90",
            "max": "90",
            "default": "-",
            "unit": "deg",
            "uri": "-"
        },
        {
            "name": "weather_Radn",
            "description": "Daily global shortwave radiation at surface",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "MJ m-2 d-1",
            "uri": "-"
        },
        {
            "name": "weather_AirPressure",
            "description": "Air pressure",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "500",
            "max": "1100",
            "default": "-",
            "unit": "hPa",
            "uri": "-"
        },
        {
            "name": "weather_Wind",
            "description": "Wind speed at instrument height",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "m s-1",
            "uri": "-"
        },
        {
            "name": "clock_Today_DayOfYear",
            "description": "Day of year",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "-",
            "unit": "d",
            "uri": "-"
        },
        {
            "name": "InitialValues",
            "description": "Optional initial soil temperature profile from top layer down",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "DepthToConstantTemperature",
            "description": "Depth to lower boundary where temperature is assumed constant",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "10000.0",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "instrumHeight",
            "description": "Instrument (wind/air temperature) height above surface; default set if zero",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "0.0",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "state",
            "description": "Model state dictionary from initialize_SoilTemperature",
            "inputtype": "variable",
            "category": "state",
            "datatype": "-",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "waterBalance_Eo",
            "description": "Potential evaporation",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm d-1",
            "uri": "-"
        },
        {
            "name": "waterBalance_Eos",
            "description": "Soil evaporation supply (potential from soil)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm d-1",
            "uri": "-"
        },
        {
            "name": "waterBalance_Es",
            "description": "Actual soil evaporation",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm d-1",
            "uri": "-"
        }
    ],
    "outputs": [
        {
            "name": "soilTemp",
            "description": "Soil temperature at all nodes including air and surface",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "minSoilTemp",
            "description": "Minimum soil temperature per node accumulated over the day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "maxSoilTemp",
            "description": "Maximum soil temperature per node accumulated over the day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "aveSoilTemp",
            "description": "Average soil temperature per node over the day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "morningSoilTemp",
            "description": "Snapshot of soil temperatures at morning (~05:00)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "volSpecHeatSoil",
            "description": "Volumetric specific heat capacity per node",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J m-3 K-1",
            "uri": "-"
        },
        {
            "name": "thermalConductivity",
            "description": "Thermal conductivity per node (including air node as boundary)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W m-1 K-1",
            "uri": "-"
        },
        {
            "name": "heatStorage",
            "description": "Effective heat storage coefficient per node for the time step",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W m-2 K-1",
            "uri": "-"
        },
        {
            "name": "thermalConductance",
            "description": "Conductance between nodes for heat transfer",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W m-2 K-1",
            "uri": "-"
        },
        {
            "name": "boundaryLayerConductance",
            "description": "Daily mean boundary layer conductance at the surface node",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W m-2 K-1",
            "uri": "-"
        },
        {
            "name": "newTemperature",
            "description": "Working array of temperatures solved by tridiagonal solver for current sub-step",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "airTemperature",
            "description": "Interpolated air temperature used as boundary condition",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "netRadiation",
            "description": "Net radiation reaching the soil over each internal time step",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "MJ m-2 per timestep",
            "uri": "-"
        },
        {
            "name": "internalTimeStep",
            "description": "Internal sub-daily time step length",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "1",
            "max": "-",
            "default": "-",
            "unit": "s",
            "uri": "-"
        },
        {
            "name": "timeOfDaySecs",
            "description": "Current simulation time within the day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "86400",
            "default": "-",
            "unit": "s",
            "uri": "-"
        },
        {
            "name": "soilWater",
            "description": "Updated soil water content by layer mapped to nodes",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "m3 m-3",
            "uri": "-"
        },
        {
            "name": "canopyHeight",
            "description": "Canopy height used for boundary layer calculations",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "instrumentHeight",
            "description": "Instrument height, constrained to exceed canopy height + 0.5 m",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0.5",
            "max": "-",
            "default": "-",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "maxTempYesterday",
            "description": "Stored maximum air temperature from the previous day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-60",
            "max": "70",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        },
        {
            "name": "minTempYesterday",
            "description": "Stored minimum air temperature from the previous day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-90",
            "max": "50",
            "default": "-",
            "unit": "degC",
            "uri": "-"
        }
    ],
    "functions": [
        {
            "name": "initialize_SoilTemperature",
            "description": "Builds node/layer geometry, initializes soil temperatures, parameters, and state arrays."
        },
        {
            "name": "process_SoilTemperature",
            "description": "Performs sub-daily radiation, energy balance, boundary layer, and heat diffusion to update soil thermal state."
        },
        {
            "name": "Sum",
            "description": "Helper to sum a sequence between start and end indices (inclusive)."
        },
        {
            "name": "ToCumThickness",
            "description": "Computes cumulative thickness array."
        },
        {
            "name": "Divide",
            "description": "Safe division with error value on zero denominator."
        },
        {
            "name": "ValuesInArray",
            "description": "Checks whether an array contains usable values (not sentinel)."
        },
        {
            "name": "ToCumThickness_nodes",
            "description": "Alias wrapper for ToCumThickness used for nodes."
        },
        {
            "name": "calcSoilTemperature",
            "description": "Initializes soil temperature using a damped annual sinusoid with depth."
        },
        {
            "name": "calcSurfaceTemperature",
            "description": "Empirical surface temperature from albedo, mean and max air temperature, and radiation."
        },
        {
            "name": "Zero",
            "description": "Sets all elements of an array to zero."
        },
        {
            "name": "kelvinT",
            "description": "Converts Celsius to Kelvin."
        },
        {
            "name": "longWaveRadn",
            "description": "Computes longwave radiation via Stefan–Boltzmann law."
        },
        {
            "name": "airDensity",
            "description": "Computes air density from temperature and pressure."
        },
        {
            "name": "doNetRadiation",
            "description": "Distributes daily radiation into sub-daily steps and estimates cloud fraction and vapor parameter."
        },
        {
            "name": "volumetricSpecificHeat",
            "description": "Specific heat for soil constituents."
        },
        {
            "name": "volumetricFractionRocks",
            "description": "Volumetric fraction of rock fragments."
        },
        {
            "name": "volumetricFractionOrganicMatter",
            "description": "Volumetric fraction of organic matter from carbon and bulk density."
        },
        {
            "name": "volumetricFractionSand",
            "description": "Volumetric fraction of sand."
        },
        {
            "name": "volumetricFractionSilt",
            "description": "Volumetric fraction of silt."
        },
        {
            "name": "volumetricFractionClay",
            "description": "Volumetric fraction of clay."
        },
        {
            "name": "volumetricFractionWater",
            "description": "Volumetric fraction of water."
        },
        {
            "name": "volumetricFractionIce",
            "description": "Volumetric fraction of ice (here 0)."
        },
        {
            "name": "volumetricFractionAir",
            "description": "Volumetric fraction of air as remaining pore space."
        },
        {
            "name": "ThermalConductance",
            "description": "Returns conductance for a given constituent (note: code sets result to specific heat, per original)."
        },
        {
            "name": "shapeFactor",
            "description": "Returns shape factor for a constituent (note: code sets result to specific heat, per original)."
        },
        {
            "name": "mapLayer2Node",
            "description": "Linearly maps layer-based values to nodes by depth weighting."
        },
        {
            "name": "doVolumetricSpecificHeat",
            "description": "Aggregates volumetric specific heat at nodes and maps to the node grid."
        },
        {
            "name": "doThermalConductivity",
            "description": "Computes effective thermal conductivity at nodes from constituent mixing rules."
        },
        {
            "name": "interpolateTemperature",
            "description": "Generates sub-daily air temperature from daily min/max and a sinusoidal diurnal cycle."
        },
        {
            "name": "interpolateNetRadiation",
            "description": "Computes net shortwave and longwave radiation reaching the soil per sub-step."
        },
        {
            "name": "getBoundaryLayerConductance",
            "description": "Computes boundary layer conductance from wind, stability, and radiative conductance."
        },
        {
            "name": "math_log",
            "description": "Safe natural logarithm (returns 0 if argument <= 0)."
        },
        {
            "name": "doThomas",
            "description": "Tridiagonal solver applying Crank–Nicolson scheme to update temperatures."
        },
        {
            "name": "doUpdate",
            "description": "Commits new temperatures, updates daily min/max/avg, and accumulates diagnostics."
        }
    ],
    "tests": "-"
}