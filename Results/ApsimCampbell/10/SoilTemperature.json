{
    "metadata": {
        "Title": "SoilTemperature",
        "Authors": "-",
        "Institution": "-",
        "URI": "-",
        "DOI": "-",
        "Extended description": "The soil temperature model includes functionality for simulating the heat flux and temperatures over the soil profile, includes temperature on the soil surface. Processes are based on Campbell (1985). The profile is represented by soil layers and temperature nodes; arrays are 0-based with node 0 = air, 1 = surface, 2.. = soil nodes.",
        "Short description": "Simulates soil heat fluxes and temperature profile (including surface temperature) using numerical solution of heat diffusion (Thomas algorithm) and Campbell-based thermal properties.",
        "Model version": "-"
    },
    "init": {
        "name": "OnStartOfSimulation",
        "firstLine": "doInitialisationStuff = true;",
        "lastLine": "InitialValues = pInitialValues;"
    },
    "process": {
        "name": "doProcess",
        "description": "Perform actions for current day: compute net radiation, thermal properties, iterate sub-daily heat flow, update min/max/average soil temperatures and boundary layer conductance.",
        "firstLine": "const int interactionsPerDay = 48;     // number of iterations in a day",
        "lastLine": "maxTempYesterday = weather.MaxT;"
    },
    "inputs": [
        {
            "name": "weather_Tav",
            "description": "Average daily air temperature (Tav)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MeanT",
            "description": "Mean air temperature (MeanT)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MaxT",
            "description": "Maximum daily air temperature (MaxT)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MinT",
            "description": "Minimum daily air temperature (MinT)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Radn",
            "description": "Daily incoming solar radiation (Radn)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "MJ/m2",
            "uri": ""
        },
        {
            "name": "weather_Latitude",
            "description": "Site latitude",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90",
            "max": "90",
            "default": "-",
            "unit": "degrees",
            "uri": ""
        },
        {
            "name": "weather_Wind",
            "description": "Wind speed used for boundary-layer conductance",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "m/s",
            "uri": ""
        },
        {
            "name": "weather_AirPressure",
            "description": "Air pressure",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "hPa",
            "uri": ""
        },
        {
            "name": "weather_Amp",
            "description": "Daily temperature amplitude (used in initial sinusoidal profile)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "clock_Today_DayOfYear",
            "description": "Day of year from clock (Today.DayOfYear)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "-",
            "unit": "day of year",
            "uri": ""
        },
        {
            "name": "microClimate_CanopyHeight",
            "description": "Canopy height from MicroClimate component (used to compute aerodynamic roughness) (mm)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "physical_Thickness",
            "description": "Thickness of soil layers from Physical component (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "physical_BD",
            "description": "Soil bulk density (BD) from Physical component (g/cm3)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": ""
        },
        {
            "name": "physical_Rocks",
            "description": "Rocks fraction per layer from Physical component (%)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeSand",
            "description": "Sand fraction per layer (%)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeSilt",
            "description": "Silt fraction per layer (%)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeClay",
            "description": "Clay fraction per layer (%)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "organic_Carbon",
            "description": "Carbon content per layer from Organic component (%)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "waterBalance_SW",
            "description": "Soil water content per layer from water balance (SW) (m3/m3)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "m3/m3",
            "uri": ""
        },
        {
            "name": "waterBalance_Eo",
            "description": "Reference evapotranspiration (Eo) from water balance component",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "waterBalance_Eos",
            "description": "Surface-adjusted evapotranspiration (Eos) from water balance component",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "waterBalance_Es",
            "description": "Actual soil evaporation (Es) from water balance component",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": ""
        },
        {
            "name": "waterBalance_Salb",
            "description": "Soil surface albedo (Salb) from water balance component",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "1.0",
            "default": "-",
            "unit": "fraction",
            "uri": ""
        },
        {
            "name": "InitialValues",
            "description": "Initial soil temperature values provided to model (oC)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "-50.0",
            "max": "100.0",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "DepthToConstantTemperature",
            "description": "Depth down to the constant temperature zone (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": 10000.0,
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "pInitialValues",
            "description": "Internal storage for initial values (private field)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "timestep",
            "description": "Internal time-step (seconds) used as base for internalTimeStep",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": 86400.0,
            "unit": "s",
            "uri": ""
        },
        {
            "name": "nu",
            "description": "Forward/backward differencing coefficient (time weighting, 0-1)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": 0.6,
            "unit": "dimensionless",
            "uri": ""
        },
        {
            "name": "bareSoilRoughness",
            "description": "Roughness element height of bare soil (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": 57.0,
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "defaultTimeOfMaximumTemperature",
            "description": "Default hour of daily maximum temperature",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "24",
            "default": 14.0,
            "unit": "h",
            "uri": ""
        },
        {
            "name": "defaultInstrumentHeight",
            "description": "Default instrument height (m)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": 1.2,
            "unit": "m",
            "uri": ""
        },
        {
            "name": "constantBoundaryLayerConductance",
            "description": "Fallback constant boundary layer conductance value",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": 20.0,
            "unit": "W/K (interpreted as K/W in code context)",
            "uri": ""
        },
        {
            "name": "numPhantomNodes",
            "description": "Number of phantom nodes added below profile",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "INT",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": 5,
            "unit": "count",
            "uri": ""
        },
        {
            "name": "numIterationsForBoundaryLayerConductance",
            "description": "Number of inner iterations when computing boundary layer conductance",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "-",
            "default": 1,
            "unit": "count",
            "uri": ""
        },
        {
            "name": "latentHeatOfVapourisation",
            "description": "Latent heat of vaporisation for water",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": 2465000.0,
            "unit": "J/kg",
            "uri": ""
        },
        {
            "name": "stefanBoltzmannConstant",
            "description": "Stefan-Boltzmann constant",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": 5.67e-08,
            "unit": "W/m2/K4",
            "uri": ""
        },
        {
            "name": "thickness",
            "description": "Internal thickness array including phantom layers (mm)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers + numPhantomNodes + 1",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "bulkDensity",
            "description": "Internal bulk density array (g/cm3)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers + numPhantomNodes + 1",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": ""
        },
        {
            "name": "soilWater",
            "description": "Internal volumetric water content per layer (m3/m3)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numLayers + numPhantomNodes + 1",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "m3/m3",
            "uri": ""
        },
        {
            "name": "soilTemp",
            "description": "Temperatures at nodes (includes air, surface, soil, phantom nodes) (oC)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 2",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "newTemperature",
            "description": "Temporary array for updated temperatures during iteration (oC)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 2",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "volSpecHeatSoil",
            "description": "Volumetric heat capacity at nodes (J/K/m3)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 1",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "J/K/m3",
            "uri": ""
        },
        {
            "name": "thermalConductivity",
            "description": "Thermal conductivity at nodes (W.m/K)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 1",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "W.m/K",
            "uri": ""
        },
        {
            "name": "thermalConductance",
            "description": "Conductance between nodes (W/K)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 2",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "W/K",
            "uri": ""
        },
        {
            "name": "heatStorage",
            "description": "Heat storage (CP) between nodes (J/K)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 1",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "J/K",
            "uri": ""
        },
        {
            "name": "nodeDepth",
            "description": "Depths of nodes (m)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "numNodes + 2",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "m",
            "uri": ""
        },
        {
            "name": "numNodes",
            "description": "Number of nodes over the soil profile",
            "inputtype": "variable",
            "category": "state",
            "datatype": "INT",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "count",
            "uri": ""
        },
        {
            "name": "numLayers",
            "description": "Number of soil layers",
            "inputtype": "variable",
            "category": "state",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "-",
            "default": "-",
            "unit": "count",
            "uri": ""
        },
        {
            "name": "airTemperature",
            "description": "Air temperature used during sub-daily iterations (oC)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-50",
            "max": "60",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "netRadiation",
            "description": "Net radiation value for current internal timestep (MJ)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "MJ",
            "uri": ""
        },
        {
            "name": "boundaryLayerConductance",
            "description": "Running average of atmospheric boundary layer conductance (W/K)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W/K",
            "uri": ""
        }
    ],
    "outputs": [
        {
            "name": "FinalSoilTemperature",
            "description": "Temperatures over the soil profile at end of a day (midnight)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numLayers",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "FinalSoilSurfaceTemperature",
            "description": "Temperature of soil surface at end of a day (midnight)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "Value",
            "description": "Average soil temperature per layer (mandatory ISoilTemperature interface)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numLayers",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "AverageSoilTemperature",
            "description": "Temperatures over soil profile averaged over a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numLayers",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "AverageSoilSurfaceTemperature",
            "description": "Soil surface temperature averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MinimumSoilTemperature",
            "description": "Minimum temperatures over the soil profile within a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numLayers",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MinimumSoilSurfaceTemperature",
            "description": "Minimum soil surface temperature within a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MaximumSoilTemperature",
            "description": "Maximum temperatures over the soil profile within a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numLayers",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MaximumSoilSurfaceTemperature",
            "description": "Maximum soil surface temperature within a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "BoundaryLayerConductance",
            "description": "Atmosphere boundary layer conductance averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W/K",
            "uri": ""
        },
        {
            "name": "ThermalConductivity",
            "description": "Thermal conductivity over the soil profile",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numNodes",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "W.m/K",
            "uri": ""
        },
        {
            "name": "HeatCapacity",
            "description": "Volumetric heat capacity over the soil profile (J/K/m3)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numNodes",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J/K/m3",
            "uri": ""
        },
        {
            "name": "HeatStore",
            "description": "Heat storage over the soil profile (J/K)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numNodes",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "J/K",
            "uri": ""
        },
        {
            "name": "Thr_profile",
            "description": "Morning temperature profile copy (internal/debug)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "numNodes + 2",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        }
    ],
    "functions": [
        {
            "name": "doNetRadiation",
            "description": "Calculate initial per-timestep solar radiation partitioning, cloud fraction and air vapour concentration (used to build solarRadn array and cva/cloudFr)."
        },
        {
            "name": "doVolumetricSpecificHeat",
            "description": "Compute volumetric specific heat (Cv) of soil constituents and map layer values to node-based volSpecHeatSoil (J/K/m3)."
        },
        {
            "name": "doThermalConductivity",
            "description": "Compute thermal conductivity for each node based on constituent conductances and map layer values to node-based thermalConductivity."
        },
        {
            "name": "interpolateTemperature",
            "description": "Interpolate air temperature over the day (diurnal cycle) using sin/linear segments between min and max."
        },
        {
            "name": "interpolateNetRadiation",
            "description": "Compute net radiation (shortwave + longwave) at the soil surface for a timestep (returns MJ)."
        },
        {
            "name": "getBoundaryLayerConductance",
            "description": "Estimate atmospheric boundary-layer conductance including stability corrections, radiation term and wind/roughness effects."
        },
        {
            "name": "doThomas",
            "description": "Solve tri-diagonal system (Thomas algorithm) to compute temperatures at nodes for the heat diffusion equation (implicit/Crank-Nicolson style)."
        },
        {
            "name": "doUpdate",
            "description": "Update min, max and average soil temperature arrays from sub-daily iterations and accumulate boundaryLayerConductance."
        },
        {
            "name": "Zero",
            "description": "Utility: zero an array in-place (used to reset min/max/average arrays)."
        }
    ],
    "tests": [
        {
            "name": "-",
            "description": "-",
            "inputs": [
                {
                    "name": "-",
                    "value": "-"
                }
            ],
            "outputs": [
                {
                    "name": "-",
                    "value": "-"
                }
            ]
        }
    ]
}