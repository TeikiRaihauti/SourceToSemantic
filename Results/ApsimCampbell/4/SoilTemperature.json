{
    "metadata": {
        "Title": "SoilTemperature",
        "Authors": "-",
        "Institution": "-",
        "URI": "-",
        "DOI": "-",
        "Extended description": "Soil temperature model that simulates heat flux and temperatures over the soil profile (including surface). Processes are based largely on Campbell (1985). The model represents the profile by soil layers and temperature nodes and computes heat transfer using a numerical scheme (Thomas algorithm) with options for boundary layer conductance and radiation computation.",
        "Short description": "Simulates soil temperature profile and heat fluxes over time (based on Campbell, 1985).",
        "Model version": "-"
    },
    "init": {
        "name": "OnStartOfSimulation",
        "firstLine": "doInitialisationStuff = true;",
        "lastLine": "InitialValues = pInitialValues;"
    },
    "process": {
        "name": "doProcess",
        "description": "Perform actions for current day",
        "firstLine": "const int interactionsPerDay = 48;     // number of iterations in a day",
        "lastLine": "maxTempYesterday = weather.MaxT;"
    },
    "inputs": [
        {
            "name": "Thickness",
            "description": "Thickness of soil layers (mm) (model property)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "InitialValues",
            "description": "Initial values for the temperature in each layer (oC)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "DepthToConstantTemperature",
            "description": "Depth down to the constant temperature (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "10000.0",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "pInitialValues",
            "description": "Private initial temperature values (internal)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "instrumHeight",
            "description": "Instrument height (internal, may be overridden by defaultInstrumentHeight)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "0.0",
            "unit": "m",
            "uri": ""
        },
        {
            "name": "physical_Thickness",
            "description": "Soil layer thickness from Physical component (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "physical_BD",
            "description": "Soil bulk density from Physical component (g/cm3)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "g/cm3",
            "uri": ""
        },
        {
            "name": "physical_Rocks",
            "description": "Volumetric fraction of rocks in each soil layer (%) from Physical component",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeSand",
            "description": "Sand fraction per layer (%) from Physical component",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeSilt",
            "description": "Silt fraction per layer (%) from Physical component",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeClay",
            "description": "Clay fraction per layer (%) from Physical component",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "organic_Carbon",
            "description": "Carbon (organic matter) fraction per layer (%) from Organic component",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "waterBalance_SW",
            "description": "Soil water content array (used to populate soilWater) from SoilWater component (volumetric, mm3/mm3)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "m3/m3",
            "uri": ""
        },
        {
            "name": "waterBalance_Es",
            "description": "Actual surface evaporation (used for latent heat flux)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "mm/day",
            "uri": ""
        },
        {
            "name": "waterBalance_Eo",
            "description": "Potential evaporation (Eo) used for radiation/penetration calculations",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "mm/day",
            "uri": ""
        },
        {
            "name": "waterBalance_Eos",
            "description": "Cover-corrected evaporation (Eos) used for penetration constant",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "mm/day",
            "uri": ""
        },
        {
            "name": "waterBalance_Salb",
            "description": "Soil albedo (fraction) from SoilWater component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "1.0",
            "default": "",
            "unit": "fraction",
            "uri": ""
        },
        {
            "name": "weather_MeanT",
            "description": "Mean air temperature (oC)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MaxT",
            "description": "Maximum daily air temperature (oC)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MinT",
            "description": "Minimum daily air temperature (oC)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Tav",
            "description": "Tav used for seasonal soil temperature profile (oC)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Amp",
            "description": "Amplitude of annual temperature variation (oC)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Radn",
            "description": "Daily solar radiation (MJ/m2)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "MJ/m2",
            "uri": ""
        },
        {
            "name": "weather_Latitude",
            "description": "Latitude (degrees)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90.0",
            "max": "90.0",
            "default": "",
            "unit": "degrees",
            "uri": ""
        },
        {
            "name": "weather_Wind",
            "description": "Wind speed (m/s)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "",
            "default": "",
            "unit": "m/s",
            "uri": ""
        },
        {
            "name": "weather_AirPressure",
            "description": "Air pressure (hPa)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "hPa",
            "uri": ""
        },
        {
            "name": "clock_Today_DayOfYear",
            "description": "Current day of year (clock.Today.DayOfYear)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "",
            "unit": "day index",
            "uri": ""
        },
        {
            "name": "microClimate_CanopyHeight",
            "description": "Canopy height (mm) from MicroClimate component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "",
            "default": "",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "nu",
            "description": "Forward/backward differencing coefficient (weighting for numerical scheme)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "1.0",
            "default": "0.6",
            "unit": "",
            "uri": ""
        },
        {
            "name": "boundarLayerConductanceSource",
            "description": "Flag whether boundary layer conductance is calculated or provided ('calc' or 'constant')",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "",
            "max": "",
            "default": "calc",
            "unit": "",
            "uri": ""
        },
        {
            "name": "netRadiationSource",
            "description": "Flag whether net radiation is calculated or taken from EOS ('calc' or 'eos')",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "",
            "max": "",
            "default": "calc",
            "unit": "",
            "uri": ""
        },
        {
            "name": "constantBoundaryLayerConductance",
            "description": "Boundary layer conductance used when boundarLayerConductanceSource='constant' (K/W)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "20",
            "unit": "K/W",
            "uri": ""
        },
        {
            "name": "numIterationsForBoundaryLayerConductance",
            "description": "Number of iterations to calculate atmosphere boundary layer conductance",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "",
            "default": "1",
            "unit": "",
            "uri": ""
        },
        {
            "name": "timestep",
            "description": "Internal time-step (s) used in model calculations",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "86400.0",
            "unit": "s",
            "uri": ""
        },
        {
            "name": "latentHeatOfVapourisation",
            "description": "Latent heat of vapourisation for water (J/kg)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "2465000.0",
            "unit": "J/kg",
            "uri": ""
        },
        {
            "name": "stefanBoltzmannConstant",
            "description": "Stefan-Boltzmann constant (W/m2/K4)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "5.67e-08",
            "unit": "W/m2/K4",
            "uri": ""
        },
        {
            "name": "defaultTimeOfMaximumTemperature",
            "description": "Default time of maximum temperature (hours)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "24.0",
            "default": "14.0",
            "unit": "h",
            "uri": ""
        },
        {
            "name": "defaultInstrumentHeight",
            "description": "Default instrument height (m)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "1.2",
            "unit": "m",
            "uri": ""
        },
        {
            "name": "bareSoilRoughness",
            "description": "Roughness element height of bare soil (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "57",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "pom",
            "description": "Particle density of organic matter (Mg/m3)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "1.3",
            "unit": "Mg/m3",
            "uri": ""
        },
        {
            "name": "ps",
            "description": "Particle density of soil fines (Mg/m3)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "",
            "max": "",
            "default": "2.63",
            "unit": "Mg/m3",
            "uri": ""
        },
        {
            "name": "soilConstituentNames",
            "description": "Names of soil constituents used in heat capacity and conductivity calculations",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "",
            "max": "",
            "default": "[\"Rocks\",\"OrganicMatter\",\"Sand\",\"Silt\",\"Clay\",\"Water\",\"Ice\",\"Air\"]",
            "unit": "",
            "uri": ""
        },
        {
            "name": "soilWater",
            "description": "Volumetric water content array used by heat capacity and conductivity calculations (internal state)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0.0",
            "max": "1.0",
            "default": "",
            "unit": "m3/m3",
            "uri": ""
        },
        {
            "name": "volSpecHeatSoil",
            "description": "Volumetric specific heat per node (J/K/m3) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "J/K/m3",
            "uri": ""
        },
        {
            "name": "thermalConductivity",
            "description": "Thermal conductivity per node (W.m/K) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "W/m/K",
            "uri": ""
        },
        {
            "name": "heatStorage",
            "description": "Heat storage between nodes (J/K) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "J/K",
            "uri": ""
        },
        {
            "name": "thermalConductance",
            "description": "Conductance of element between nodes (W/K) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "W/K",
            "uri": ""
        },
        {
            "name": "soilTemp",
            "description": "Soil temperature at each node (oC) (internal state)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-50.0",
            "max": "100.0",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "newTemperature",
            "description": "Newly computed temperatures per node used during time-step iteration (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "morningSoilTemp",
            "description": "Soil temperature profile at morning (internal)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "nodeDepth",
            "description": "Depths of nodes (m) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "m",
            "uri": ""
        },
        {
            "name": "thickness",
            "description": "Thickness of each soil element including phantom layers (mm) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "bulkDensity",
            "description": "Bulk density per layer including phantom layers (g/cm3) (internal)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "g/cm3",
            "uri": ""
        }
    ],
    "outputs": [
        {
            "name": "FinalSoilTemperature",
            "description": "Temperatures over the soil profile at end of a day, i.e. at midnight",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "FinalSoilSurfaceTemperature",
            "description": "Temperature of soil surface at end of a day, i.e. at midnight",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "Value",
            "description": "Mandatory ISoilTemperature interface output (returns AverageSoilTemperature)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "AverageSoilTemperature",
            "description": "Temperatures over soil profile averaged over a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "AverageSoilSurfaceTemperature",
            "description": "Temperature of soil surface averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MinimumSoilTemperature",
            "description": "Minimum temperatures over the soil profile within a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MinimumSoilSurfaceTemperature",
            "description": "Minimum temperature of soil surface within a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MaximumSoilTemperature",
            "description": "Maximum temperatures over the soil profile within a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MaximumSoilSurfaceTemperature",
            "description": "Maximum temperature of soil surface within a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "BoundaryLayerConductance",
            "description": "Atmosphere boundary layer conductance averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "W/K",
            "uri": ""
        },
        {
            "name": "ThermalConductivity",
            "description": "Thermal conductivity over the soil profile",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "W.m/K",
            "uri": ""
        },
        {
            "name": "HeatCapacity",
            "description": "Volumetric heat capacity over the soil profile",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "J/K/m3",
            "uri": ""
        },
        {
            "name": "HeatStore",
            "description": "Heat storage over the soil profile",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "J/K",
            "uri": ""
        },
        {
            "name": "Thr_profile",
            "description": "Morning temperature profile (internal/misc output)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "",
            "max": "",
            "default": "",
            "unit": "oC",
            "uri": ""
        }
    ],
    "functions": [
        {
            "name": "doNetRadiation",
            "description": "Calculate initial variables for net radiation per time-step and populate solarRadn, cloudFr and cva."
        },
        {
            "name": "Zero",
            "description": "Utility to zero the specified array."
        },
        {
            "name": "doVolumetricSpecificHeat",
            "description": "Calculate volumetric specific heat capacity (Cv, J/K/m3) of each soil node."
        },
        {
            "name": "doThermalConductivity",
            "description": "Calculate thermal conductivity for each soil node based on soil constituents and water content."
        },
        {
            "name": "interpolateTemperature",
            "description": "Interpolate air temperature through the day (sub-daily time interpolation)."
        },
        {
            "name": "interpolateNetRadiation",
            "description": "Calculate the net radiation at the soil surface for a given sub-daily timestep (SW and LW components)."
        },
        {
            "name": "getBoundaryLayerConductance",
            "description": "Calculate atmospheric boundary layer conductance (including radiative conductance and stability corrections)."
        },
        {
            "name": "doThomas",
            "description": "Numerical solution (Thomas algorithm) of the tridiagonal system for heat conduction to compute new temperatures."
        },
        {
            "name": "doUpdate",
            "description": "Update min, max and average soil temperatures from sub-daily iterations and accumulate boundary layer conductance."
        }
    ],
    "tests": "-"
}