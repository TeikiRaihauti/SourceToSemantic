{
    "metadata": {
        "Title": "SoilTemperature",
        "Authors": "-",
        "Institution": "-",
        "URI": "-",
        "DOI": "-",
        "Extended description": "The soil temperature model simulates heat flux and temperatures over the soil profile including the soil surface. Processes are based on Campbell (1985) 'Soil physics with BASIC: Transport models for soil-plant systems'. The model represents the profile by soil layers and temperature nodes and solves heat flow using a Thomas algorithm with configurable boundary conditions, radiation and evaporation effects.",
        "Short description": "Simulates soil temperature profile and heat fluxes over time (diurnal and seasonal).",
        "Model version": "-"
    },
    "init": {
        "name": "OnStartOfSimulation",
        "firstLine": "doInitialisationStuff = true;",
        "lastLine": "InitialValues = pInitialValues;"
    },
    "process": {
        "name": "doProcess",
        "description": "Performs the day's soil temperature simulation: computes net radiation and boundary layer conductance, volumetric heat capacity and thermal conductivity, iterates sub-daily time steps, solves heat flow (Thomas algorithm) and updates daily min/max/average soil temperatures.",
        "firstLine": "const int interactionsPerDay = 48;     // number of iterations in a day",
        "lastLine": "maxTempYesterday = weather.MaxT;"
    },
    "inputs": [
        {
            "name": "weather_MeanT",
            "description": "Mean daily air temperature from weather component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_MaxT",
            "description": "Daily maximum air temperature from weather component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_MinT",
            "description": "Daily minimum air temperature from weather component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_Tav",
            "description": "Average air temperature (Tav) used for initialisation and seasonal estimates",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_Amp",
            "description": "Seasonal amplitude used in sinusoidal initial temperature profile",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "weather_Radn",
            "description": "Daily radiation (global) from weather component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "MJ/m2",
            "uri": "-"
        },
        {
            "name": "weather_Wind",
            "description": "Wind speed from weather component (used in boundary layer conductance)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "m/s",
            "uri": "-"
        },
        {
            "name": "weather_AirPressure",
            "description": "Air pressure from weather component (hPa) used to compute air density",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "hPa",
            "uri": "-"
        },
        {
            "name": "weather_Latitude",
            "description": "Site latitude (degrees) used for solar geometry",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90",
            "max": "90",
            "default": "-",
            "unit": "degrees",
            "uri": "-"
        },
        {
            "name": "clock_Today_DayOfYear",
            "description": "Day of year from clock (used for seasonal sinusoidal calculations)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "-",
            "unit": "day",
            "uri": "-"
        },
        {
            "name": "microClimate_CanopyHeight",
            "description": "Canopy height from MicroClimate component (mm) used to determine roughness/displacement",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "waterBalance_SW",
            "description": "Soil water in each soil layer from water balance (array)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm or mm/m2 (layer-dependent)",
            "uri": "-"
        },
        {
            "name": "waterBalance_Eo",
            "description": "Potential evaporation (Eo) used in radiation/penetration calculations",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "waterBalance_Eos",
            "description": "Effective evaporation (Eos) used for cover/penetration calculations",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "waterBalance_Es",
            "description": "Actual evaporation (Es) used to compute latent heat flux",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "waterBalance_Salb",
            "description": "Soil surface albedo from water balance component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "physical_Thickness",
            "description": "Soil layer thicknesses from Physical component (mm) (array)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "physical_BD",
            "description": "Soil bulk density array from Physical component (g/cm3)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": "-"
        },
        {
            "name": "organic_Carbon",
            "description": "Soil carbon (organic matter) fraction per layer from Organic component (array)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_Rocks",
            "description": "Volumetric fraction of rocks per layer from Physical component (array)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeSand",
            "description": "Sand fraction (%) per layer from Physical component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeSilt",
            "description": "Silt fraction (%) per layer from Physical component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "physical_ParticleSizeClay",
            "description": "Clay fraction (%) per layer from Physical component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": "-"
        },
        {
            "name": "DepthToConstantTemperature",
            "description": "Depth to constant temperature below which temperature is assumed constant (mm) (public property)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "10000.0",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "InitialValues",
            "description": "Initial soil temperature values provided (array of oC) (public property)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "pInitialValues",
            "description": "Private initial values for temperature (internal initialisation source)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "instrumHeight",
            "description": "Instrument height input (internal), used for boundary layer conductance (m)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "0.0",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "instrumentHeight",
            "description": "Instrument height used in calculations (m) (derived/adjustable)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "1.2",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "soilRoughnessHeight",
            "description": "Soil roughness height used to compute canopy/roughness (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "57",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "bareSoilRoughness",
            "description": "Default bare soil roughness height (mm)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "57",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "nu",
            "description": "Forward/backward differencing coefficient (numerical weighting) (0-1)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "1.0",
            "default": "0.6",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "boundarLayerConductanceSource",
            "description": "Source of boundary layer conductance ('calc' or 'constant')",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "calc",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "netRadiationSource",
            "description": "Source for net radiation ('calc' or 'eos') used in boundary condition",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "calc",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "timestep",
            "description": "Internal model time-step in seconds (used to compute sub-steps)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "86400.0",
            "unit": "s",
            "uri": "-"
        },
        {
            "name": "defaultTimeOfMaximumTemperature",
            "description": "Default hour of day (24h) when maximum air temperature occurs (hours)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "24",
            "default": "14.0",
            "unit": "h",
            "uri": "-"
        },
        {
            "name": "constantBoundaryLayerConductance",
            "description": "Constant boundary layer conductance used when boundarLayerConductanceSource='constant' (W/K)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "20.0",
            "unit": "W/K",
            "uri": "-"
        },
        {
            "name": "latentHeatOfVapourisation",
            "description": "Latent heat of vaporisation for water (J/kg)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "2465000.0",
            "unit": "J/kg",
            "uri": "-"
        },
        {
            "name": "stefanBoltzmannConstant",
            "description": "Stefan-Boltzmann constant (W/m2/K4)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "0.0000000567",
            "unit": "W/m2/K4",
            "uri": "-"
        },
        {
            "name": "numPhantomNodes",
            "description": "Number of phantom nodes below soil profile (used to set grid depth)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "INT",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "5",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "numNodes",
            "description": "Number of temperature nodes (derived from num layers + phantom nodes)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "INT",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "numLayers",
            "description": "Number of soil layers (derived from physical.Thickness)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "INT",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "-",
            "uri": "-"
        },
        {
            "name": "thickness",
            "description": "Thickness array used internally (mm) (derived from physical_Thickness)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": "-"
        },
        {
            "name": "bulkDensity",
            "description": "Bulk density array used internally (g/cm3) (derived from physical_BD)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": "-"
        },
        {
            "name": "soilWater",
            "description": "Volumetric water content per node/layer used in thermal calculations (m3/m3)",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "m3/m3",
            "uri": "-"
        },
        {
            "name": "soilTemp",
            "description": "Soil temperature array (oC) state used and updated by the model",
            "inputtype": "variable",
            "category": "state",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "nodeDepth",
            "description": "Depth of temperature nodes (m) (internal derived grid)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "m",
            "uri": "-"
        },
        {
            "name": "volSpecHeatSoil",
            "description": "Volumetric specific heat per node (J/K/m3) computed in doVolumetricSpecificHeat",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J/K/m3",
            "uri": "-"
        },
        {
            "name": "thermalConductivity",
            "description": "Thermal conductivity per node (W/m/K) computed in doThermalConductivity",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W/m/K",
            "uri": "-"
        },
        {
            "name": "newTemperature",
            "description": "Vector of new temperatures used in the Thomas solver (array)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "maxTempYesterday",
            "description": "Yesterday's maximum air temperature (used in interpolation)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "minTempYesterday",
            "description": "Yesterday's minimum air temperature (used in interpolation)",
            "inputtype": "variable",
            "category": "auxiliary",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        }
    ],
    "outputs": [
        {
            "name": "FinalSoilTemperature",
            "description": "Temperatures over the soil profile at end of a day (midnight)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "FinalSoilSurfaceTemperature",
            "description": "Temperature of soil surface at end of a day (midnight)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "Value",
            "description": "Average soil temperature (alias for AverageSoilTemperature) (oC)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "AverageSoilTemperature",
            "description": "Temperatures over soil profile averaged over a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "AverageSoilSurfaceTemperature",
            "description": "Temperature of soil surface averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MinimumSoilTemperature",
            "description": "Minimum temperatures over the soil profile within the day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MinimumSoilSurfaceTemperature",
            "description": "Minimum temperature of soil surface within the day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MaximumSoilTemperature",
            "description": "Maximum temperatures over the soil profile within the day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "MaximumSoilSurfaceTemperature",
            "description": "Maximum temperature of soil surface within the day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        },
        {
            "name": "BoundaryLayerConductance",
            "description": "Atmosphere boundary layer conductance averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W/K",
            "uri": "-"
        },
        {
            "name": "ThermalConductivity",
            "description": "Thermal conductivity over the soil profile (per node)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W.m/K",
            "uri": "-"
        },
        {
            "name": "HeatCapacity",
            "description": "Volumetric heat capacity over the soil profile (J/K/m3)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J/K/m3",
            "uri": "-"
        },
        {
            "name": "HeatStore",
            "description": "Heat storage over the soil profile (J/K)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "J/K",
            "uri": "-"
        },
        {
            "name": "Thr_profile",
            "description": "Internal morning temperature profile copy (array) (used for diagnostics)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": "-"
        }
    ],
    "functions": [
        {
            "name": "doNetRadiation",
            "description": "Compute per-substep solar and longwave components and helper variables (solarRadn array, cloud fraction cva) used to interpolate net radiation for sub-steps."
        },
        {
            "name": "Zero",
            "description": "Utility function to zero an array in-place."
        },
        {
            "name": "doVolumetricSpecificHeat",
            "description": "Compute volumetric specific heat (Cv) at each node from constituent specific heats and soil water content and map layers to nodes."
        },
        {
            "name": "doThermalConductivity",
            "description": "Compute thermal conductivity at each node from constituent conductivities, shape factors and map layers to nodes."
        },
        {
            "name": "interpolateTemperature",
            "description": "Interpolate air temperature through the day (hourly/sub-daily) using sinusoidal/linear functions and yesterday/today min/max."
        },
        {
            "name": "interpolateNetRadiation",
            "description": "Interpolate and compute net radiation (shortwave + longwave) for a sub-daily timestep using solarRadn, cloud fraction and soil/canopy properties."
        },
        {
            "name": "getBoundaryLayerConductance",
            "description": "Compute atmospheric boundary layer conductance (thermal) including stability corrections using wind, surface/air temperatures and canopy/roughness."
        },
        {
            "name": "doThomas",
            "description": "Solve the tri-diagonal heat conduction system using the Thomas algorithm to compute new temperatures for all nodes given conductances and storage."
        },
        {
            "name": "doUpdate",
            "description": "Update daily min, max and average soil temperatures and accumulate boundary layer conductance after each sub-step."
        }
    ],
    "tests": [
        {
            "name": "-",
            "description": "-",
            "inputs": [
                {
                    "name": "-",
                    "value": "-"
                }
            ],
            "outputs": [
                {
                    "name": "-",
                    "value": "-"
                }
            ]
        }
    ]
}