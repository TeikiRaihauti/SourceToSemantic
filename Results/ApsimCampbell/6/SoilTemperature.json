{
    "metadata": {
        "Title": "SoilTemperature",
        "Authors": "-",
        "Institution": "-",
        "URI": "-",
        "DOI": "-",
        "Extended description": "The soil temperature model simulates heat flux and temperatures over the soil profile including the soil surface. Processes are based on Campbell (1985) and include node/layer discretisation, thermal conductivity and volumetric heat capacity calculations, boundary layer conductance and a numerical solution of the heat equation (Thomas algorithm).",
        "Short description": "Simulates soil temperature profile and surface temperature using heat flow and radiation balance.",
        "Model version": "-"
    },
    "init": {
        "name": "OnStartOfSimulation",
        "firstLine": "doInitialisationStuff = true;",
        "lastLine": "InitialValues = pInitialValues;"
    },
    "process": {
        "name": "doProcess",
        "description": "Perform actions for current day (sub-daily iterations computing net radiation, thermal properties, heat flow and updating min/max/average soil temperatures).",
        "firstLine": "const int interactionsPerDay = 48;     // number of iterations in a day",
        "lastLine": "maxTempYesterday = weather.MaxT;"
    },
    "inputs": [
        {
            "name": "weather_MeanT",
            "description": "Mean daily air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MaxT",
            "description": "Maximum daily air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_MinT",
            "description": "Minimum daily air temperature",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Tav",
            "description": "Average temperature (Tav) used for initialisation and annual profile",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Amp",
            "description": "Amplitude of annual temperature variation used for initial profile",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "weather_Radn",
            "description": "Daily solar radiation (incoming)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "MJ/m2",
            "uri": ""
        },
        {
            "name": "weather_Wind",
            "description": "Wind speed used for boundary layer conductance",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "m/s",
            "uri": ""
        },
        {
            "name": "weather_Latitude",
            "description": "Site latitude used for solar geometry",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-90",
            "max": "90",
            "default": "-",
            "unit": "degrees",
            "uri": ""
        },
        {
            "name": "weather_AirPressure",
            "description": "Air pressure used to compute air density",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "hPa",
            "uri": ""
        },
        {
            "name": "clock_Today_DayOfYear",
            "description": "Current simulation day of year",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "INT",
            "len": "-",
            "min": "1",
            "max": "366",
            "default": "-",
            "unit": "day index",
            "uri": ""
        },
        {
            "name": "microClimate_CanopyHeight",
            "description": "Height of canopy above ground (used for roughness/zero-plane displacement)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "physical_Thickness",
            "description": "Thickness of soil layers (from Physical component)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "Thickness",
            "description": "Thickness of soil layers (model input property)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "physical_BD",
            "description": "Soil bulk density per layer (BD) from Physical component",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "g/cm3",
            "uri": ""
        },
        {
            "name": "organic_Carbon",
            "description": "Carbon (organic matter) fraction per layer from Organic component (%)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_Rocks",
            "description": "Fraction of rocks per layer from Physical component (%)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeSand",
            "description": "Sand fraction per layer from Physical component (%)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeSilt",
            "description": "Silt fraction per layer from Physical component (%)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "physical_ParticleSizeClay",
            "description": "Clay fraction per layer from Physical component (%)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "100",
            "default": "-",
            "unit": "%",
            "uri": ""
        },
        {
            "name": "waterBalance_SW",
            "description": "Soil water content per layer from WaterBalance (volumetric fraction m3/m3)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "m3/m3",
            "uri": ""
        },
        {
            "name": "waterBalance_Eo",
            "description": "Reference evaporation (Eo) used for penetration constant",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "mm or MJ-based unit (model dependent)",
            "uri": ""
        },
        {
            "name": "waterBalance_Eos",
            "description": "Soil/cover adjusted reference evaporation (Eos) used for penetration constant",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "same units as Eo",
            "uri": ""
        },
        {
            "name": "waterBalance_Es",
            "description": "Actual evaporation (Es) used to compute latent heat flux",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "mm (model dependent)",
            "uri": ""
        },
        {
            "name": "waterBalance_Salb",
            "description": "Soil albedo (fraction)",
            "inputtype": "variable",
            "category": "exogenous",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "1",
            "default": "-",
            "unit": "fraction",
            "uri": ""
        },
        {
            "name": "InitialValues",
            "description": "Initial temperature values for each layer (model input property) (oC)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLEARRAY",
            "len": "-",
            "min": "-50",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "DepthToConstantTemperature",
            "description": "Depth down to the constant temperature zone used to create phantom nodes",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "10000.0",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "instrumHeight",
            "description": "Instrument height above ground (used to set instrumentHeight if > 0)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "0.0",
            "unit": "m",
            "uri": ""
        },
        {
            "name": "boundarLayerConductanceSource",
            "description": "Flag whether boundary layer conductance is calculated or use constant ('calc' or 'constant')",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "calc",
            "unit": "",
            "uri": ""
        },
        {
            "name": "netRadiationSource",
            "description": "Flag whether net radiation is calculated or computed from EOS ('calc' or 'eos')",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "CHAR",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "calc",
            "unit": "",
            "uri": ""
        },
        {
            "name": "nu",
            "description": "Forward/backward differencing coefficient (numerical weighting, 0-1)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0.0",
            "max": "1.0",
            "default": "0.6",
            "unit": "dimensionless",
            "uri": ""
        },
        {
            "name": "defaultTimeOfMaximumTemperature",
            "description": "Default hour of maximum temperature (used in diurnal interpolation)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "24",
            "default": "14.0",
            "unit": "hour",
            "uri": ""
        },
        {
            "name": "latentHeatOfVapourisation",
            "description": "Latent heat of vaporisation for water (constant)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "2465000.0",
            "unit": "J/kg",
            "uri": ""
        },
        {
            "name": "stefanBoltzmannConstant",
            "description": "Stefan-Boltzmann constant used for longwave radiation",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "0.0000000567",
            "unit": "W/m2/K4",
            "uri": ""
        },
        {
            "name": "bareSoilRoughness",
            "description": "Roughness element height of bare soil (used for boundary layer)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "57",
            "unit": "mm",
            "uri": ""
        },
        {
            "name": "pom",
            "description": "Particle density of organic matter (Mg/m3)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "1.3",
            "unit": "Mg/m3",
            "uri": ""
        },
        {
            "name": "ps",
            "description": "Particle density of soil fines (Mg/m3)",
            "inputtype": "parameter",
            "category": "constant",
            "datatype": "DOUBLE",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "2.63",
            "unit": "Mg/m3",
            "uri": ""
        }
    ],
    "outputs": [
        {
            "name": "FinalSoilTemperature",
            "description": "Temperatures over the soil profile at end of a day (midnight)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "FinalSoilSurfaceTemperature",
            "description": "Temperature of soil surface at end of day (midnight)",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "AverageSoilTemperature",
            "description": "Temperatures over soil profile averaged over a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "AverageSoilSurfaceTemperature",
            "description": "Temperature of soil surface averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MinimumSoilTemperature",
            "description": "Minimum temperatures over the soil profile within a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MinimumSoilSurfaceTemperature",
            "description": "Minimum temperature of soil surface within a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MaximumSoilTemperature",
            "description": "Maximum temperatures over the soil profile within a day",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "MaximumSoilSurfaceTemperature",
            "description": "Maximum temperature of soil surface within a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "-100",
            "max": "100",
            "default": "-",
            "unit": "oC",
            "uri": ""
        },
        {
            "name": "BoundaryLayerConductance",
            "description": "Atmosphere boundary layer conductance averaged over a day",
            "datatype": "DOUBLE",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "W/K",
            "uri": ""
        },
        {
            "name": "ThermalConductivity",
            "description": "Thermal conductivity over the soil profile (node-based)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "W.m/K",
            "uri": ""
        },
        {
            "name": "HeatCapacity",
            "description": "Volumetric heat capacity over the soil profile (node-based)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "0",
            "max": "-",
            "default": "-",
            "unit": "J/K/m3",
            "uri": ""
        },
        {
            "name": "HeatStore",
            "description": "Heat storage over the soil profile (node-based)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "J/K",
            "uri": ""
        },
        {
            "name": "Thr_profile",
            "description": "Morning soil temperature profile (internal/diagnostic)",
            "datatype": "DOUBLEARRAY",
            "category": "state",
            "len": "-",
            "min": "-",
            "max": "-",
            "default": "-",
            "unit": "oC",
            "uri": ""
        }
    ],
    "functions": [
        {
            "name": "doNetRadiation",
            "description": "Calculate initial variables for net radiation per time-step (fills solarRadn array, cloud fraction and vapour concentration)."
        },
        {
            "name": "doVolumetricSpecificHeat",
            "description": "Calculate the volumetric specific heat capacity (Cv) of each soil node (returns volSpecHeatSoil)."
        },
        {
            "name": "doThermalConductivity",
            "description": "Calculate thermal conductivity for each soil node using constituent shape factors and conductances."
        },
        {
            "name": "interpolateTemperature",
            "description": "Interpolate air temperature for a given time of day using min/max/mean and diurnal functions."
        },
        {
            "name": "interpolateNetRadiation",
            "description": "Calculate net radiation (shortwave + longwave) at the soil surface for a timestep."
        },
        {
            "name": "getBoundaryLayerConductance",
            "description": "Calculate atmospheric boundary layer conductance (combined radiative+convective) given surface and air temperatures."
        },
        {
            "name": "doThomas",
            "description": "Solve the tri-diagonal heat flow matrix using the Thomas algorithm to compute new temperatures."
        },
        {
            "name": "doUpdate",
            "description": "Update min, max and average soil temperature arrays and accumulate boundary layer conductance over sub-daily steps."
        },
        {
            "name": "Zero",
            "description": "Utility to zero an array (set all elements to 0)."
        }
    ],
    "tests": "-"
}