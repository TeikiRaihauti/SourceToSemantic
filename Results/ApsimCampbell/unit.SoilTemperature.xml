<?xml version="1.0" ?>
<ModelUnit modelid=".Soil Temperature model (APSIM Next Generation)" name="Soil Temperature model (APSIM Next Generation)" timestep="1" version="-">
	<Description>
		<Title>Soil Temperature model (APSIM Next Generation)</Title>
		<Authors>APSIM Initiative</Authors>
		<Institution>APSIM Initiative</Institution>
		<URI>https://github.com/APSIMInitiative/ApsimX/blob/master/Models/Soils/SoilTemp/SoilTemperature.cs</URI>
		<Reference>-</Reference>
		<ExtendedDescription>A 1D soil temperature component in APSIM Next Generation which simulates heat flow through a soil profile using a finite-difference approach solved with the Thomas algorithm. The profile is represented by nodes for air (aboveground), the soil surface, layer centers, and several phantom nodes below the profile to enforce a lower boundary condition. Thermal properties (volumetric heat capacity and thermal conductivity) are derived from soil constituents, water content, and bulk density. Atmospheric boundary layer conductance and net radiation are computed following formulations from Campbell (1985), with sub-daily time-stepping to produce daily minimum, maximum, and average soil and surface temperatures.</ExtendedDescription>
		<ShortDescription>APSIM Next Gen component for simulating soil temperature profiles and surface energy exchange based on Campbell (1985).</ShortDescription>
	</Description>
	<Inputs>
		<Input name="weather_Tav" description="Average air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="weather_Amp" description="Annual temperature amplitude" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="weather_Latitude" description="Site latitude" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degrees" uri=""/>
		<Input name="clock_Today_DayOfYear" description="Day of year" inputtype="variable" variablecategory="exogenous" datatype="INT" max="" min="" default="" unit="-" uri=""/>
		<Input name="physical_Thickness" description="Soil layer thicknesses" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="mm" uri=""/>
		<Input name="physical_BD" description="Soil bulk density per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="g/cm3" uri=""/>
		<Input name="physical_Rocks" description="Rock fragments per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="physical_ParticleSizeSand" description="Sand fraction per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="physical_ParticleSizeSilt" description="Silt fraction per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="physical_ParticleSizeClay" description="Clay fraction per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="organic_Carbon" description="Organic carbon per layer" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="waterBalance_SW" description="Soil water content by layer" inputtype="variable" variablecategory="exogenous" datatype="DOUBLEARRAY" len="-" max="" min="" default="-" unit="m3/m3" uri=""/>
		<Input name="waterBalance_Salb" description="Soil albedo" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="-" uri=""/>
		<Input name="weather_MeanT" description="Mean air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="weather_MaxT" description="Maximum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="weather_MinT" description="Minimum air temperature" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="weather_Radn" description="Incoming shortwave radiation" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="MJ/m2/d" uri=""/>
		<Input name="instrumHeight" description="Instrument height above surface" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="0.0" unit="m" uri=""/>
		<Input name="DepthToConstantTemperature" description="Depth to constant temperature lower boundary" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="10000.0" unit="mm" uri=""/>
		<Input name="boundarLayerConductanceSource" description="Boundary layer conductance calculation source (calc or constant)" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="" min="" default="calc" unit="-" uri=""/>
		<Input name="netRadiationSource" description="Net radiation source (calc or alternative)" inputtype="parameter" parametercategory="constant" datatype="CHAR" max="" min="" default="calc" unit="-" uri=""/>
		<Input name="defaultTimeOfMaximumTemperature" description="Default hour of maximum daily temperature" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="14.0" unit="h" uri=""/>
		<Input name="nu" description="Implicit weighting factor for numerical scheme" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="0.6" unit="-" uri=""/>
		<Input name="InitialValues" description="Optional initial soil temperatures per node, starting at topsoil" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="-" unit="degC" uri=""/>
		<Input name="weather_AirPressure" description="Air pressure" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="hPa" uri=""/>
		<Input name="weather_Wind" description="Wind speed at instrument height" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="m/s" uri=""/>
		<Input name="waterBalance_Eos" description="Potential soil evaporation (surface)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="mm/d" uri=""/>
		<Input name="waterBalance_Eo" description="Potential evaporation (reference)" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="mm/d" uri=""/>
		<Input name="waterBalance_Es" description="Actual soil evaporation" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="mm/d" uri=""/>
		<Input name="microClimate_CanopyHeight" description="Canopy height" inputtype="variable" variablecategory="exogenous" datatype="DOUBLE" max="" min="" default="" unit="mm" uri=""/>
		<Input name="numLayers" description="Number of soil layers" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="" unit="-" uri=""/>
		<Input name="numNodes" description="Number of numerical nodes (layers + phantom nodes)" inputtype="parameter" parametercategory="constant" datatype="INT" max="" min="" default="" unit="-" uri=""/>
		<Input name="thickness" description="Node-associated layer thicknesses including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="mm" uri=""/>
		<Input name="nodeDepth" description="Depth of each node" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="m" uri=""/>
		<Input name="thermCondPar1" description="Thermal conductivity coefficient 1 per element" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="-" uri=""/>
		<Input name="thermCondPar2" description="Thermal conductivity coefficient 2 per element" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="-" uri=""/>
		<Input name="thermCondPar3" description="Thermal conductivity coefficient 3 per element" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="-" uri=""/>
		<Input name="thermCondPar4" description="Thermal conductivity coefficient 4 per element" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="-" uri=""/>
		<Input name="volSpecHeatSoil" description="Volumetric specific heat capacity at nodes" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="J/m3/K" uri=""/>
		<Input name="soilTemp" description="Soil temperature at nodes (includes air and surface nodes)" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="degC" uri=""/>
		<Input name="morningSoilTemp" description="Soil temperature snapshot near morning (around 5am)" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="degC" uri=""/>
		<Input name="heatStorage" description="Heat storage vector from solver" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="-" uri=""/>
		<Input name="thermalConductance" description="Thermal conductance between nodes" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="-" uri=""/>
		<Input name="thermalConductivity" description="Thermal conductivity per node" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="W/m/K" uri=""/>
		<Input name="newTemperature" description="Provisional temperature vector used by solver" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="degC" uri=""/>
		<Input name="bulkDensity" description="Bulk density at nodes/layers including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="g/cm3" uri=""/>
		<Input name="soilWater" description="Volumetric soil water content at nodes/layers" inputtype="variable" variablecategory="auxiliary" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="m3/m3" uri=""/>
		<Input name="minSoilTemp" description="Daily minimum soil temperature per node" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="degC" uri=""/>
		<Input name="maxSoilTemp" description="Daily maximum soil temperature per node" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="degC" uri=""/>
		<Input name="aveSoilTemp" description="Daily average soil temperature per node" inputtype="variable" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="degC" uri=""/>
		<Input name="boundaryLayerConductance" description="Average atmospheric boundary layer conductance over the day" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="-" uri=""/>
		<Input name="internalTimeStep" description="Internal timestep per interaction" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="s" uri=""/>
		<Input name="timeOfDaySecs" description="Current time of day in seconds for iteration" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="s" uri=""/>
		<Input name="netRadiation" description="Net radiation at soil surface per internal timestep" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="MJ/m2/step" uri=""/>
		<Input name="canopyHeight" description="Canopy height used for BL calculations (m)" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="m" uri=""/>
		<Input name="airTemperature" description="Air temperature at current timestep" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="maxTempYesterday" description="Yesterday maximum temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="minTempYesterday" description="Yesterday minimum temperature" inputtype="variable" variablecategory="state" datatype="DOUBLE" max="" min="" default="" unit="degC" uri=""/>
		<Input name="instrumentHeight" description="Instrument height carried from initialization" inputtype="parameter" parametercategory="constant" datatype="DOUBLE" max="" min="" default="" unit="m" uri=""/>
		<Input name="rocks" description="Rock fragments per node/layer including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="carbon" description="Organic carbon per node/layer including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="sand" description="Sand fraction per node/layer including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="silt" description="Silt fraction per node/layer including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
		<Input name="clay" description="Clay fraction per node/layer including phantom nodes" inputtype="parameter" parametercategory="constant" datatype="DOUBLEARRAY" len="-" max="" min="" default="" unit="percent" uri=""/>
	</Inputs>
	<Outputs>
		<Output name="soilTemp" description="Updated soil temperatures per node" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="degC" uri=""/>
		<Output name="minSoilTemp" description="Daily minimum soil temperatures per node" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="degC" uri=""/>
		<Output name="maxSoilTemp" description="Daily maximum soil temperatures per node" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="degC" uri=""/>
		<Output name="aveSoilTemp" description="Daily average soil temperatures per node" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="degC" uri=""/>
		<Output name="thermalConductivity" description="Thermal conductivity per node" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="W/m/K" uri=""/>
		<Output name="volSpecHeatSoil" description="Volumetric specific heat capacity per node" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="J/m3/K" uri=""/>
		<Output name="heatStorage" description="Heat storage vector" variablecategory="state" datatype="DOUBLEARRAY" len="-" max="" min="" unit="-" uri=""/>
		<Output name="boundaryLayerConductance" description="Average boundary layer conductance" variablecategory="state" datatype="DOUBLE" max="" min="" unit="-" uri=""/>
		<Output name="internalTimeStep" description="Internal timestep length" variablecategory="state" datatype="DOUBLE" max="" min="" unit="s" uri=""/>
		<Output name="timeOfDaySecs" description="Time of day in seconds at last iteration" variablecategory="state" datatype="DOUBLE" max="" min="" unit="s" uri=""/>
		<Output name="netRadiation" description="Net radiation over last internal timestep" variablecategory="state" datatype="DOUBLE" max="" min="" unit="MJ/m2/step" uri=""/>
		<Output name="canopyHeight" description="Canopy height used in calculations" variablecategory="state" datatype="DOUBLE" max="" min="" unit="m" uri=""/>
		<Output name="airTemperature" description="Air temperature at end of process" variablecategory="state" datatype="DOUBLE" max="" min="" unit="degC" uri=""/>
		<Output name="maxTempYesterday" description="Stored maximum air temperature of current day for next step" variablecategory="state" datatype="DOUBLE" max="" min="" unit="degC" uri=""/>
		<Output name="minTempYesterday" description="Stored minimum air temperature of current day for next step" variablecategory="state" datatype="DOUBLE" max="" min="" unit="degC" uri=""/>
	</Outputs>
	<Initialization name="OnStartOfSimulation" language="cyml" filename="algo/pyx/OnStartOfSimulation.pyx"/>
	<Function name="Divide" description="Divide value1 by value2 with fallback error value" language="cyml" type="external" filename="algo/pyx/Divide.pyx"/>
	<Function name="ValuesInArray" description="Check for any non-missing values in an array" language="cyml" type="external" filename="algo/pyx/ValuesInArray.pyx"/>
	<Function name="Sum" description="Sum a list from startIndex to endIndex inclusive, skipping missing values" language="cyml" type="external" filename="algo/pyx/Sum.pyx"/>
	<Function name="Zero" description="Zero out all elements of an array" language="cyml" type="external" filename="algo/pyx/Zero.pyx"/>
	<Function name="ToCumThickness" description="Compute cumulative thickness per layer (mm)" language="cyml" type="external" filename="algo/pyx/ToCumThickness.pyx"/>
	<Function name="kelvinT" description="Convert Celsius to Kelvin" language="cyml" type="external" filename="algo/pyx/kelvinT.pyx"/>
	<Function name="longWaveRadn" description="Compute long-wave radiation emitted by a body" language="cyml" type="external" filename="algo/pyx/longWaveRadn.pyx"/>
	<Function name="airDensity" description="Calculate air density from temperature and pressure" language="cyml" type="external" filename="algo/pyx/airDensity.pyx"/>
	<Function name="volumetricSpecificHeat" description="Get volumetric specific heat (MJ/m3/K) of soil constituents" language="cyml" type="external" filename="algo/pyx/volumetricSpecificHeat.pyx"/>
	<Function name="volumetricFractionRocks" description="Volumetric fraction of rocks in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionRocks.pyx"/>
	<Function name="volumetricFractionOrganicMatter" description="Volumetric fraction of organic matter in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionOrganicMatter.pyx"/>
	<Function name="volumetricFractionSand" description="Volumetric fraction of sand in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionSand.pyx"/>
	<Function name="volumetricFractionSilt" description="Volumetric fraction of silt in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionSilt.pyx"/>
	<Function name="volumetricFractionClay" description="Volumetric fraction of clay in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionClay.pyx"/>
	<Function name="volumetricFractionWater" description="Volumetric fraction of water in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionWater.pyx"/>
	<Function name="volumetricFractionIce" description="Volumetric fraction of ice in soil (always 0)" language="cyml" type="external" filename="algo/pyx/volumetricFractionIce.pyx"/>
	<Function name="volumetricFractionAir" description="Volumetric fraction of air in soil" language="cyml" type="external" filename="algo/pyx/volumetricFractionAir.pyx"/>
	<Function name="ThermalConductance" description="Get thermal conductance of constituents (returns specific heat due to replicated bug)" language="cyml" type="external" filename="algo/pyx/ThermalConductance.pyx"/>
	<Function name="shapeFactor" description="Get shape factor of soil constituents (returns specific heat due to replicated bug)" language="cyml" type="external" filename="algo/pyx/shapeFactor.pyx"/>
	<Function name="mapLayer2Node" description="Map layer-based array to node-based array using depths and thicknesses" language="cyml" type="external" filename="algo/pyx/mapLayer2Node.pyx"/>
	<Function name="doThermalConductivityCoeffs" description="Compute empirical thermal conductivity coefficients" language="cyml" type="external" filename="algo/pyx/doThermalConductivityCoeffs.pyx"/>
	<Function name="interpolateTemperature" description="Interpolate hourly air temperature over the day" language="cyml" type="external" filename="algo/pyx/interpolateTemperature.pyx"/>
	<Function name="doVolumetricSpecificHeat" description="Compute volumetric specific heat per node" language="cyml" type="external" filename="algo/pyx/doVolumetricSpecificHeat.pyx"/>
	<Function name="doThermalConductivity" description="Compute thermal conductivity per node" language="cyml" type="external" filename="algo/pyx/doThermalConductivity.pyx"/>
	<Function name="doThomas" description="Solve tridiagonal system for heat conduction via Thomas algorithm" language="cyml" type="external" filename="algo/pyx/doThomas.pyx"/>
	<Function name="doUpdate" description="Update min, max, average soil temperatures and boundary layer conductance" language="cyml" type="external" filename="algo/pyx/doUpdate.pyx"/>
	<Function name="getBoundaryLayerConductance" description="Compute atmospheric boundary layer conductance with stability corrections" language="cyml" type="external" filename="algo/pyx/getBoundaryLayerConductance.pyx"/>
	<Function name="calcLayerTemperature" description="Compute average soil temperature for a layer (not used)" language="cyml" type="external" filename="algo/pyx/calcLayerTemperature.pyx"/>
	<Function name="calcSurfaceTemperature" description="Compute initial soil surface temperature" language="cyml" type="external" filename="algo/pyx/calcSurfaceTemperature.pyx"/>
	<Function name="doNetRadiation" description="Distribute daily radiation over steps and estimate cloud fraction and emissivity factor" language="cyml" type="external" filename="algo/pyx/doNetRadiation.pyx"/>
	<Function name="interpolateNetRadiation" description="Compute net radiation at soil surface for a timestep" language="cyml" type="external" filename="algo/pyx/interpolateNetRadiation.pyx"/>
	<Function name="calcSoilTemperature" description="Compute average soil temperature profile using analytical solution" language="cyml" type="external" filename="algo/pyx/calcSoilTemperature.pyx"/>
	<Algorithm language="cyml" platform="" filename="algo/pyx/OnProcess.pyx"/>
	<Parametersets/>
	<Testsets/>
</ModelUnit>
